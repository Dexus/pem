<!DOCTYPE html>

<html>
<head>
  <title>pem.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="../docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="helper.html">
                  lib/helper.js
                </a>
              
                
                <a class="source" href="openssl.html">
                  lib/openssl.js
                </a>
              
                
                <a class="source" href="pem.html">
                  lib/pem.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>pem.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-1">&#x00a7;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-meta">&#x27;use strict&#x27;</span>

<span class="hljs-comment">/**
 * pem module
 *
 * <span class="hljs-doctag">@module</span> <span class="hljs-variable">pem</span>
 */</span>
<span class="hljs-keyword">const</span> {debug} = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./debug.js&#x27;</span>)
<span class="hljs-keyword">const</span> {promisify} = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;es6-promisify&#x27;</span>)
<span class="hljs-keyword">var</span> net = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;net&#x27;</span>)
<span class="hljs-keyword">var</span> helper = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./helper.js&#x27;</span>)
<span class="hljs-keyword">var</span> openssl = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./openssl.js&#x27;</span>)
<span class="hljs-keyword">const</span> hash_md5 = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;md5&quot;</span>)

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span>.<span class="hljs-property">createPrivateKey</span> = createPrivateKey
<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span>.<span class="hljs-property">createDhparam</span> = createDhparam
<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span>.<span class="hljs-property">createEcparam</span> = createEcparam
<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span>.<span class="hljs-property">createCSR</span> = createCSR
<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span>.<span class="hljs-property">createCertificate</span> = createCertificate
<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span>.<span class="hljs-property">readCertificateInfo</span> = readCertificateInfo
<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span>.<span class="hljs-property">getPublicKey</span> = getPublicKey
<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span>.<span class="hljs-property">getFingerprint</span> = getFingerprint
<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span>.<span class="hljs-property">getModulus</span> = getModulus
<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span>.<span class="hljs-property">getDhparamInfo</span> = getDhparamInfo
<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span>.<span class="hljs-property">createPkcs12</span> = createPkcs12
<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span>.<span class="hljs-property">readPkcs12</span> = readPkcs12
<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span>.<span class="hljs-property">verifySigningChain</span> = verifySigningChain
<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span>.<span class="hljs-property">checkCertificate</span> = checkCertificate
<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span>.<span class="hljs-property">checkPkcs12</span> = checkPkcs12
<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span>.<span class="hljs-property">config</span> = config

<span class="hljs-comment">/**
 * quick access the convert module
 * <span class="hljs-doctag">@type</span> {<span class="hljs-type">module:convert</span>}
 */</span>
<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span>.<span class="hljs-property">convert</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./convert.js&#x27;</span>)

<span class="hljs-keyword">var</span> <span class="hljs-variable constant_">KEY_START</span> = <span class="hljs-string">&#x27;-----BEGIN PRIVATE KEY-----&#x27;</span>
<span class="hljs-keyword">var</span> <span class="hljs-variable constant_">KEY_END</span> = <span class="hljs-string">&#x27;-----END PRIVATE KEY-----&#x27;</span>
<span class="hljs-keyword">var</span> <span class="hljs-variable constant_">RSA_KEY_START</span> = <span class="hljs-string">&#x27;-----BEGIN RSA PRIVATE KEY-----&#x27;</span>
<span class="hljs-keyword">var</span> <span class="hljs-variable constant_">RSA_KEY_END</span> = <span class="hljs-string">&#x27;-----END RSA PRIVATE KEY-----&#x27;</span>
<span class="hljs-keyword">var</span> <span class="hljs-variable constant_">ENCRYPTED_KEY_START</span> = <span class="hljs-string">&#x27;-----BEGIN ENCRYPTED PRIVATE KEY-----&#x27;</span>
<span class="hljs-keyword">var</span> <span class="hljs-variable constant_">ENCRYPTED_KEY_END</span> = <span class="hljs-string">&#x27;-----END ENCRYPTED PRIVATE KEY-----&#x27;</span>
<span class="hljs-keyword">var</span> <span class="hljs-variable constant_">CERT_START</span> = <span class="hljs-string">&#x27;-----BEGIN CERTIFICATE-----&#x27;</span>
<span class="hljs-keyword">var</span> <span class="hljs-variable constant_">CERT_END</span> = <span class="hljs-string">&#x27;-----END CERTIFICATE-----&#x27;</span>

<span class="hljs-comment">/**
 * Creates a private key
 *
 * <span class="hljs-doctag">@static</span>
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Number</span>} [keyBitsize=2048] Size of the key, defaults to 2048bit
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Object</span>} [options] object of cipher and password {cipher:&#x27;aes128&#x27;,password:&#x27;xxx&#x27;}, defaults empty object
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">String</span>} [options.cipher] string of the cipher for the encryption - needed with password
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">String</span>} [options.password] string of the cipher password for the encryption needed with cipher
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Function</span>} callback Callback function with an error object and {key}
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">createPrivateKey</span>(<span class="hljs-params">keyBitsize, options, callback</span>) {
  <span class="hljs-keyword">if</span> (!callback &amp;&amp; !options &amp;&amp; <span class="hljs-keyword">typeof</span> keyBitsize === <span class="hljs-string">&#x27;function&#x27;</span>) {
    callback = keyBitsize
    keyBitsize = <span class="hljs-literal">undefined</span>
    options = {}
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!callback &amp;&amp; keyBitsize &amp;&amp; <span class="hljs-keyword">typeof</span> options === <span class="hljs-string">&#x27;function&#x27;</span>) {
    callback = options
    options = {}
  }

  keyBitsize = <span class="hljs-title class_">Number</span>(keyBitsize) || <span class="hljs-number">2048</span>

  <span class="hljs-keyword">var</span> params = [<span class="hljs-string">&#x27;genrsa&#x27;</span>]

  <span class="hljs-keyword">if</span> (openssl.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;Vendor&#x27;</span>) === <span class="hljs-string">&#x27;OPENSSL&#x27;</span> &amp;&amp; openssl.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;VendorVersionMajor&#x27;</span>) &gt;= <span class="hljs-number">3</span>) {
    params.<span class="hljs-title function_">push</span>(<span class="hljs-string">&#x27;-traditional&#x27;</span>)
  }

  <span class="hljs-keyword">var</span> delTempPWFiles = []

  <span class="hljs-keyword">if</span> (options &amp;&amp; options.<span class="hljs-property">cipher</span> &amp;&amp; (<span class="hljs-title class_">Number</span>(helper.<span class="hljs-property">ciphers</span>.<span class="hljs-title function_">indexOf</span>(options.<span class="hljs-property">cipher</span>)) !== -<span class="hljs-number">1</span>) &amp;&amp; options.<span class="hljs-property">password</span>) {
    <span class="hljs-title function_">debug</span>(<span class="hljs-string">&#x27;helper.createPasswordFile&#x27;</span>, {
      <span class="hljs-attr">cipher</span>: options.<span class="hljs-property">cipher</span>,
      <span class="hljs-attr">password</span>: options.<span class="hljs-property">password</span>,
      <span class="hljs-attr">passType</span>: <span class="hljs-string">&#x27;out&#x27;</span>
    })
    helper.<span class="hljs-title function_">createPasswordFile</span>({
      <span class="hljs-attr">cipher</span>: options.<span class="hljs-property">cipher</span>,
      <span class="hljs-attr">password</span>: options.<span class="hljs-property">password</span>,
      <span class="hljs-attr">passType</span>: <span class="hljs-string">&#x27;out&#x27;</span>
    }, params, delTempPWFiles)
  }

  params.<span class="hljs-title function_">push</span>(keyBitsize)

  <span class="hljs-title function_">debug</span>(<span class="hljs-string">&#x27;version&#x27;</span>, openssl.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;openSslVersion&#x27;</span>))

  openssl.<span class="hljs-title function_">exec</span>(params, <span class="hljs-string">&#x27;(RSA |ENCRYPTED |)PRIVATE KEY&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">sslErr, key</span>) {
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">done</span>(<span class="hljs-params">err</span>) {
      <span class="hljs-keyword">if</span> (err) {
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">callback</span>(err)
      }
      <span class="hljs-keyword">return</span> <span class="hljs-title function_">callback</span>(<span class="hljs-literal">null</span>, {
        <span class="hljs-attr">key</span>: key
      })
    }

    helper.<span class="hljs-title function_">deleteTempFiles</span>(delTempPWFiles, <span class="hljs-keyword">function</span> (<span class="hljs-params">fsErr</span>) {
      <span class="hljs-title function_">debug</span>(<span class="hljs-string">&#x27;createPrivateKey&#x27;</span>, {
        <span class="hljs-attr">sslErr</span>: sslErr,
        <span class="hljs-attr">fsErr</span>: fsErr,
        <span class="hljs-attr">key</span>: key,
        <span class="hljs-attr">keyLength</span>: key &amp;&amp; key.<span class="hljs-property">length</span>
      })
      <span class="hljs-title function_">done</span>(sslErr || fsErr)
    })
  })
}

<span class="hljs-comment">/**
 * Creates a dhparam key
 *
 * <span class="hljs-doctag">@static</span>
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Number</span>} [keyBitsize=512] Size of the key, defaults to 512bit
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Function</span>} callback Callback function with an error object and {dhparam}
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">createDhparam</span>(<span class="hljs-params">keyBitsize, callback</span>) {
  <span class="hljs-keyword">if</span> (!callback &amp;&amp; <span class="hljs-keyword">typeof</span> keyBitsize === <span class="hljs-string">&#x27;function&#x27;</span>) {
    callback = keyBitsize
    keyBitsize = <span class="hljs-literal">undefined</span>
  }

  keyBitsize = <span class="hljs-title class_">Number</span>(keyBitsize) || <span class="hljs-number">512</span>

  <span class="hljs-keyword">var</span> params = [<span class="hljs-string">&#x27;dhparam&#x27;</span>,
    <span class="hljs-string">&#x27;-outform&#x27;</span>,
    <span class="hljs-string">&#x27;PEM&#x27;</span>,
    keyBitsize
  ]

  openssl.<span class="hljs-title function_">exec</span>(params, <span class="hljs-string">&#x27;DH PARAMETERS&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">error, dhparam</span>) {
    <span class="hljs-keyword">if</span> (error) {
      <span class="hljs-keyword">return</span> <span class="hljs-title function_">callback</span>(error)
    }
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">callback</span>(<span class="hljs-literal">null</span>, {
      <span class="hljs-attr">dhparam</span>: dhparam
    })
  })
}

<span class="hljs-comment">/**
 * Creates a ecparam key
 * <span class="hljs-doctag">@static</span>
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">String</span>} [keyName=secp256k1] Name of the key, defaults to secp256k1
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">String</span>} [paramEnc=explicit] Encoding of the elliptic curve parameters, defaults to explicit
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Boolean</span>} [noOut=false] This option inhibits the output of the encoded version of the parameters.
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Function</span>} callback Callback function with an error object and {ecparam}
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">createEcparam</span>(<span class="hljs-params">keyName, paramEnc, noOut, callback</span>) {
  <span class="hljs-keyword">if</span> (!callback &amp;&amp; <span class="hljs-keyword">typeof</span> noOut === <span class="hljs-string">&#x27;undefined&#x27;</span> &amp;&amp; !paramEnc &amp;&amp; <span class="hljs-keyword">typeof</span> keyName === <span class="hljs-string">&#x27;function&#x27;</span>) {
    callback = keyName
    keyName = <span class="hljs-literal">undefined</span>
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!callback &amp;&amp; <span class="hljs-keyword">typeof</span> noOut === <span class="hljs-string">&#x27;undefined&#x27;</span> &amp;&amp; keyName &amp;&amp; <span class="hljs-keyword">typeof</span> paramEnc === <span class="hljs-string">&#x27;function&#x27;</span>) {
    callback = paramEnc
    paramEnc = <span class="hljs-literal">undefined</span>
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!callback &amp;&amp; <span class="hljs-keyword">typeof</span> noOut === <span class="hljs-string">&#x27;function&#x27;</span> &amp;&amp; keyName &amp;&amp; paramEnc) {
    callback = noOut
    noOut = <span class="hljs-literal">undefined</span>
  }

  keyName = keyName || <span class="hljs-string">&#x27;secp256k1&#x27;</span>
  paramEnc = paramEnc || <span class="hljs-string">&#x27;explicit&#x27;</span>
  noOut = noOut || <span class="hljs-literal">false</span>

  <span class="hljs-keyword">var</span> params = [<span class="hljs-string">&#x27;ecparam&#x27;</span>,
    <span class="hljs-string">&#x27;-name&#x27;</span>,
    keyName,
    <span class="hljs-string">&#x27;-genkey&#x27;</span>,
    <span class="hljs-string">&#x27;-param_enc&#x27;</span>,
    paramEnc
  ]

  <span class="hljs-keyword">var</span> searchString = <span class="hljs-string">&#x27;EC PARAMETERS&#x27;</span>
  <span class="hljs-keyword">if</span> (noOut) {
    params.<span class="hljs-title function_">push</span>(<span class="hljs-string">&#x27;-noout&#x27;</span>)
    searchString = <span class="hljs-string">&#x27;EC PRIVATE KEY&#x27;</span>
  }

  openssl.<span class="hljs-title function_">exec</span>(params, searchString, <span class="hljs-keyword">function</span> (<span class="hljs-params">error, ecparam</span>) {
    <span class="hljs-keyword">if</span> (error) {
      <span class="hljs-keyword">return</span> <span class="hljs-title function_">callback</span>(error)
    }
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">callback</span>(<span class="hljs-literal">null</span>, {
      <span class="hljs-attr">ecparam</span>: ecparam
    })
  })
}

<span class="hljs-comment">/**
 * Creates a Certificate Signing Request
 * If client key is undefined, a new key is created automatically. The used key is included
 * in the callback return as clientKey
 * <span class="hljs-doctag">@static</span>
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Object</span>} [options] Optional options object
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">String</span>} [options.clientKey] Optional client key to use
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Number</span>} [options.keyBitsize] If clientKey is undefined, bit size to use for generating a new key (defaults to 2048)
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">String</span>} [options.hash] Hash function to use (either md5 sha1 or sha256, defaults to sha256)
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">String</span>} [options.country] CSR country field
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">String</span>} [options.state] CSR state field
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">String</span>} [options.locality] CSR locality field
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">String</span>} [options.organization] CSR organization field
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">String</span>} [options.organizationUnit] CSR organizational unit field
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">String</span>} [options.commonName=&#x27;localhost&#x27;] CSR common name field
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">String</span>} [options.emailAddress] CSR email address field
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">String</span>} [options.csrConfigFile] CSR config file
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Array</span>}  [options.altNames] is a list of subjectAltNames in the subjectAltName field
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Function</span>} callback Callback function with an error object and {csr, clientKey}
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">createCSR</span>(<span class="hljs-params">options, callback</span>) {
  <span class="hljs-keyword">if</span> (!callback &amp;&amp; <span class="hljs-keyword">typeof</span> options === <span class="hljs-string">&#x27;function&#x27;</span>) {
    callback = options
    options = <span class="hljs-literal">undefined</span>
  }

  <span class="hljs-keyword">let</span> delTempPWFiles = []

  options = options || {}</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-2">&#x00a7;</a>
              </div>
              <p><a href="http://stackoverflow.com/questions/14089872/why-does-node-js-accept-ip-addresses-in-certificates-only-for-san-not-for-cn">http://stackoverflow.com/questions/14089872/why-does-node-js-accept-ip-addresses-in-certificates-only-for-san-not-for-cn</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span> (options.<span class="hljs-property">commonName</span> &amp;&amp; (net.<span class="hljs-title function_">isIPv4</span>(options.<span class="hljs-property">commonName</span>) || net.<span class="hljs-title function_">isIPv6</span>(options.<span class="hljs-property">commonName</span>))) {
    <span class="hljs-keyword">if</span> (!options.<span class="hljs-property">altNames</span>) {
      options.<span class="hljs-property">altNames</span> = [options.<span class="hljs-property">commonName</span>]
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (options.<span class="hljs-property">altNames</span>.<span class="hljs-title function_">indexOf</span>(options.<span class="hljs-property">commonName</span>) === -<span class="hljs-number">1</span>) {
      options.<span class="hljs-property">altNames</span> = options.<span class="hljs-property">altNames</span>.<span class="hljs-title function_">concat</span>([options.<span class="hljs-property">commonName</span>])
    }
  }

  <span class="hljs-keyword">if</span> (!options.<span class="hljs-property">clientKey</span>) {
    <span class="hljs-keyword">if</span> (options &amp;&amp; (options.<span class="hljs-property">password</span> || options.<span class="hljs-property">clientKeyPassword</span>)) {
      options.<span class="hljs-property">password</span> = options.<span class="hljs-property">password</span> || options.<span class="hljs-property">clientKeyPassword</span> || <span class="hljs-string">&#x27;&#x27;</span>
    }
    <span class="hljs-title function_">createPrivateKey</span>(options.<span class="hljs-property">keyBitsize</span> || <span class="hljs-number">2048</span>, options, <span class="hljs-keyword">function</span> (<span class="hljs-params">error, keyData</span>) {
      <span class="hljs-keyword">if</span> (error) {
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">callback</span>(error)
      }
      options.<span class="hljs-property">clientKey</span> = keyData.<span class="hljs-property">key</span>

      <span class="hljs-title function_">createCSR</span>(options, callback)
    })
    <span class="hljs-keyword">return</span>
  }

  <span class="hljs-keyword">var</span> params = [<span class="hljs-string">&#x27;req&#x27;</span>,
    <span class="hljs-string">&#x27;-new&#x27;</span>,
    <span class="hljs-string">&#x27;-&#x27;</span> + (options.<span class="hljs-property">hash</span> || <span class="hljs-string">&#x27;sha256&#x27;</span>)
  ]

  <span class="hljs-keyword">if</span> (options.<span class="hljs-property">csrConfigFile</span>) {
    params.<span class="hljs-title function_">push</span>(<span class="hljs-string">&#x27;-config&#x27;</span>)
    params.<span class="hljs-title function_">push</span>(options.<span class="hljs-property">csrConfigFile</span>)
  } <span class="hljs-keyword">else</span> {
    params.<span class="hljs-title function_">push</span>(<span class="hljs-string">&#x27;-subj&#x27;</span>)
    params.<span class="hljs-title function_">push</span>(<span class="hljs-title function_">generateCSRSubject</span>(options))
  }

  params.<span class="hljs-title function_">push</span>(<span class="hljs-string">&#x27;-key&#x27;</span>)
  params.<span class="hljs-title function_">push</span>(<span class="hljs-string">&#x27;--TMPFILE--&#x27;</span>)

  <span class="hljs-keyword">var</span> tmpfiles = [options.<span class="hljs-property">clientKey</span>]
  <span class="hljs-keyword">var</span> config = <span class="hljs-literal">null</span>

  <span class="hljs-keyword">if</span> (options &amp;&amp; (options.<span class="hljs-property">password</span> || options.<span class="hljs-property">clientKeyPassword</span>)) {
    helper.<span class="hljs-title function_">createPasswordFile</span>({
      <span class="hljs-attr">cipher</span>: <span class="hljs-string">&#x27;&#x27;</span>,
      <span class="hljs-attr">password</span>: options.<span class="hljs-property">password</span> || options.<span class="hljs-property">clientKeyPassword</span>,
      <span class="hljs-attr">passType</span>: <span class="hljs-string">&#x27;in&#x27;</span>
    }, params, delTempPWFiles)
  }

  <span class="hljs-keyword">if</span> (options.<span class="hljs-property">altNames</span> &amp;&amp; <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(options.<span class="hljs-property">altNames</span>) &amp;&amp; options.<span class="hljs-property">altNames</span>.<span class="hljs-property">length</span>) {
    params.<span class="hljs-title function_">push</span>(<span class="hljs-string">&#x27;-extensions&#x27;</span>)
    params.<span class="hljs-title function_">push</span>(<span class="hljs-string">&#x27;v3_req&#x27;</span>)
    params.<span class="hljs-title function_">push</span>(<span class="hljs-string">&#x27;-config&#x27;</span>)
    params.<span class="hljs-title function_">push</span>(<span class="hljs-string">&#x27;--TMPFILE--&#x27;</span>)
    <span class="hljs-keyword">var</span> altNamesRep = []
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; options.<span class="hljs-property">altNames</span>.<span class="hljs-property">length</span>; i++) {
      altNamesRep.<span class="hljs-title function_">push</span>((net.<span class="hljs-title function_">isIP</span>(options.<span class="hljs-property">altNames</span>[i]) ? <span class="hljs-string">&#x27;IP&#x27;</span> : <span class="hljs-string">&#x27;DNS&#x27;</span>) + <span class="hljs-string">&#x27;.&#x27;</span> + (i + <span class="hljs-number">1</span>) + <span class="hljs-string">&#x27; = &#x27;</span> + options.<span class="hljs-property">altNames</span>[i])
    }

    tmpfiles.<span class="hljs-title function_">push</span>(config = [
      <span class="hljs-string">&#x27;[req]&#x27;</span>,
      <span class="hljs-string">&#x27;req_extensions = v3_req&#x27;</span>,
      <span class="hljs-string">&#x27;distinguished_name = req_distinguished_name&#x27;</span>,
      <span class="hljs-string">&#x27;[v3_req]&#x27;</span>,
      <span class="hljs-string">&#x27;subjectAltName = @alt_names&#x27;</span>,
      <span class="hljs-string">&#x27;[alt_names]&#x27;</span>,
      altNamesRep.<span class="hljs-title function_">join</span>(<span class="hljs-string">&#x27;\n&#x27;</span>),
      <span class="hljs-string">&#x27;[req_distinguished_name]&#x27;</span>,
      <span class="hljs-string">&#x27;commonName = Common Name&#x27;</span>,
      <span class="hljs-string">&#x27;commonName_max = 64&#x27;</span>
    ].<span class="hljs-title function_">join</span>(<span class="hljs-string">&#x27;\n&#x27;</span>))
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (options.<span class="hljs-property">config</span>) {
    config = options.<span class="hljs-property">config</span>
  }


  <span class="hljs-keyword">if</span> (options.<span class="hljs-property">clientKeyPassword</span>) {
    helper.<span class="hljs-title function_">createPasswordFile</span>({
      <span class="hljs-attr">cipher</span>: <span class="hljs-string">&#x27;&#x27;</span>,
      <span class="hljs-attr">password</span>: options.<span class="hljs-property">clientKeyPassword</span>,
      <span class="hljs-attr">passType</span>: <span class="hljs-string">&#x27;in&#x27;</span>
    }, params, delTempPWFiles)
  }

  openssl.<span class="hljs-title function_">exec</span>(params, <span class="hljs-string">&#x27;CERTIFICATE REQUEST&#x27;</span>, tmpfiles, <span class="hljs-keyword">function</span> (<span class="hljs-params">sslErr, data</span>) {
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">done</span>(<span class="hljs-params">err</span>) {
      <span class="hljs-keyword">if</span> (err) {
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">callback</span>(err)
      }
      <span class="hljs-title function_">callback</span>(<span class="hljs-literal">null</span>, {
        <span class="hljs-attr">csr</span>: data,
        <span class="hljs-attr">config</span>: config,
        <span class="hljs-attr">clientKey</span>: options.<span class="hljs-property">clientKey</span>
      })
    }

    helper.<span class="hljs-title function_">deleteTempFiles</span>(delTempPWFiles, <span class="hljs-keyword">function</span> (<span class="hljs-params">fsErr</span>) {
      <span class="hljs-title function_">done</span>(sslErr || fsErr)
    })
  })
}

<span class="hljs-comment">/**
 * Creates a certificate based on a CSR. If CSR is not defined, a new one
 * will be generated automatically. For CSR generation all the options values
 * can be used as with createCSR.
 * <span class="hljs-doctag">@static</span>
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Object</span>} [options] Optional options object
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">String</span>} [options.serviceCertificate] PEM encoded certificate
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">String</span>} [options.serviceKey] Private key for signing the certificate, if not defined a new one is generated
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">String</span>} [options.serviceKeyPassword] Password of the service key
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Boolean</span>} [options.selfSigned] If set to true and serviceKey is not defined, use clientKey for signing
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">String|Number</span>} [options.serial] Set a serial max. 20 octets - only together with options.serviceCertificate
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">String</span>} [options.serialFile] Set the name of the serial file, without extension. - only together with options.serviceCertificate and never in tandem with options.serial
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">String</span>} [options.hash] Hash function to use (either md5 sha1 or sha256, defaults to sha256)
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">String</span>} [options.csr] CSR for the certificate, if not defined a new one is generated
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Number</span>} [options.days] Certificate expire time in days
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">String</span>} [options.clientKeyPassword] Password of the client key
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">String</span>} [options.extFile] extension config file - without &#x27;-extensions v3_req&#x27;
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">String</span>} [options.config] extension config file - with &#x27;-extensions v3_req&#x27;
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">String</span>} [options.csrConfigFile] CSR config file - only used if no options.csr is provided
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Array</span>}  [options.altNames] is a list of subjectAltNames in the subjectAltName field - only used if no options.csr is provided
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Function</span>} callback Callback function with an error object and {certificate, csr, clientKey, serviceKey}
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">createCertificate</span>(<span class="hljs-params">options, callback</span>) {
  <span class="hljs-keyword">if</span> (!callback &amp;&amp; <span class="hljs-keyword">typeof</span> options === <span class="hljs-string">&#x27;function&#x27;</span>) {
    callback = options
    options = <span class="hljs-literal">undefined</span>
  }

  options = options || {}

  <span class="hljs-keyword">if</span> (!options.<span class="hljs-property">csr</span>) {
    <span class="hljs-title function_">createCSR</span>(options, <span class="hljs-keyword">function</span> (<span class="hljs-params">error, keyData</span>) {
      <span class="hljs-keyword">if</span> (error) {
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">callback</span>(error)
      }
      options.<span class="hljs-property">csr</span> = keyData.<span class="hljs-property">csr</span>
      options.<span class="hljs-property">config</span> = keyData.<span class="hljs-property">config</span>
      options.<span class="hljs-property">clientKey</span> = keyData.<span class="hljs-property">clientKey</span>
      <span class="hljs-title function_">createCertificate</span>(options, callback)
    })
    <span class="hljs-keyword">return</span>
  }

  <span class="hljs-keyword">if</span> (!options.<span class="hljs-property">clientKey</span>) {
    options.<span class="hljs-property">clientKey</span> = <span class="hljs-string">&#x27;&#x27;</span>
  }

  <span class="hljs-keyword">if</span> (!options.<span class="hljs-property">serviceKey</span>) {
    <span class="hljs-keyword">if</span> (options.<span class="hljs-property">selfSigned</span>) {
      options.<span class="hljs-property">serviceKey</span> = options.<span class="hljs-property">clientKey</span>
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-title function_">createPrivateKey</span>(options.<span class="hljs-property">keyBitsize</span> || <span class="hljs-number">2048</span>, {
        <span class="hljs-attr">cipher</span>: options.<span class="hljs-property">cipher</span>,
        <span class="hljs-attr">password</span>: options.<span class="hljs-property">clientKeyPassword</span> || <span class="hljs-string">&#x27;&#x27;</span>
      }, <span class="hljs-keyword">function</span> (<span class="hljs-params">error, keyData</span>) {
        <span class="hljs-keyword">if</span> (error) {
          <span class="hljs-keyword">return</span> <span class="hljs-title function_">callback</span>(error)
        }
        options.<span class="hljs-property">serviceKey</span> = keyData.<span class="hljs-property">key</span>
        <span class="hljs-title function_">createCertificate</span>(options, callback)
      })
      <span class="hljs-keyword">return</span>
    }
  }

  <span class="hljs-title function_">readCertificateInfo</span>(options.<span class="hljs-property">csr</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">error2, data2</span>) {
    <span class="hljs-keyword">if</span> (error2) {
      <span class="hljs-keyword">return</span> <span class="hljs-title function_">callback</span>(error2)
    }

    <span class="hljs-keyword">var</span> params = [<span class="hljs-string">&#x27;x509&#x27;</span>,
      <span class="hljs-string">&#x27;-req&#x27;</span>,
      <span class="hljs-string">&#x27;-&#x27;</span> + (options.<span class="hljs-property">hash</span> || <span class="hljs-string">&#x27;sha256&#x27;</span>),
      <span class="hljs-string">&#x27;-days&#x27;</span>,
      <span class="hljs-title class_">Number</span>(options.<span class="hljs-property">days</span>) || <span class="hljs-string">&#x27;365&#x27;</span>,
      <span class="hljs-string">&#x27;-in&#x27;</span>,
      <span class="hljs-string">&#x27;--TMPFILE--&#x27;</span>
    ]
    <span class="hljs-keyword">var</span> tmpfiles = [options.<span class="hljs-property">csr</span>]
    <span class="hljs-keyword">var</span> delTempPWFiles = []

    <span class="hljs-keyword">if</span> (options.<span class="hljs-property">serviceCertificate</span>) {
      params.<span class="hljs-title function_">push</span>(<span class="hljs-string">&#x27;-CA&#x27;</span>)
      params.<span class="hljs-title function_">push</span>(<span class="hljs-string">&#x27;--TMPFILE--&#x27;</span>)
      params.<span class="hljs-title function_">push</span>(<span class="hljs-string">&#x27;-CAkey&#x27;</span>)
      params.<span class="hljs-title function_">push</span>(<span class="hljs-string">&#x27;--TMPFILE--&#x27;</span>)
      <span class="hljs-keyword">if</span> (options.<span class="hljs-property">serial</span>) {
        params.<span class="hljs-title function_">push</span>(<span class="hljs-string">&#x27;-set_serial&#x27;</span>)
        <span class="hljs-keyword">if</span> (helper.<span class="hljs-title function_">isNumber</span>(options.<span class="hljs-property">serial</span>)) {</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-3">&#x00a7;</a>
              </div>
              <p>set the serial to the max lenth of 20 octets ()
A certificate serial number is not decimal conforming. That is the
bytes in a serial number do not necessarily map to a printable ASCII
character.
eg: 0x00 is a valid serial number and can not be represented in a
human readable format (atleast one that can be directly mapped to
the ACSII table).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          params.<span class="hljs-title function_">push</span>(<span class="hljs-string">&#x27;0x&#x27;</span> + (<span class="hljs-string">&#x27;0000000000000000000000000000000000000000&#x27;</span> + options.<span class="hljs-property">serial</span>.<span class="hljs-title function_">toString</span>(<span class="hljs-number">16</span>)).<span class="hljs-title function_">slice</span>(-<span class="hljs-number">40</span>))
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-keyword">if</span> (helper.<span class="hljs-title function_">isHex</span>(options.<span class="hljs-property">serial</span>)) {
            <span class="hljs-keyword">if</span> (options.<span class="hljs-property">serial</span>.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">&#x27;0x&#x27;</span>)) {
              options.<span class="hljs-property">serial</span> = options.<span class="hljs-property">serial</span>.<span class="hljs-title function_">substring</span>(<span class="hljs-number">2</span>, options.<span class="hljs-property">serial</span>.<span class="hljs-property">length</span>)
            }
            params.<span class="hljs-title function_">push</span>(<span class="hljs-string">&#x27;0x&#x27;</span> + (<span class="hljs-string">&#x27;0000000000000000000000000000000000000000&#x27;</span> + options.<span class="hljs-property">serial</span>).<span class="hljs-title function_">slice</span>(-<span class="hljs-number">40</span>))
          } <span class="hljs-keyword">else</span> {
            params.<span class="hljs-title function_">push</span>(<span class="hljs-string">&#x27;0x&#x27;</span> + (<span class="hljs-string">&#x27;0000000000000000000000000000000000000000&#x27;</span> + helper.<span class="hljs-title function_">toHex</span>(options.<span class="hljs-property">serial</span>)).<span class="hljs-title function_">slice</span>(-<span class="hljs-number">40</span>))
          }
        }
      } <span class="hljs-keyword">else</span> {
        params.<span class="hljs-title function_">push</span>(<span class="hljs-string">&#x27;-CAcreateserial&#x27;</span>)
        <span class="hljs-keyword">if</span> (options.<span class="hljs-property">serialFile</span>) {
          params.<span class="hljs-title function_">push</span>(<span class="hljs-string">&#x27;-CAserial&#x27;</span>)
          params.<span class="hljs-title function_">push</span>(options.<span class="hljs-property">serialFile</span> + <span class="hljs-string">&#x27;.srl&#x27;</span>)
        }
      }
      <span class="hljs-keyword">if</span> (options.<span class="hljs-property">serviceKeyPassword</span>) {
        helper.<span class="hljs-title function_">createPasswordFile</span>({
          <span class="hljs-attr">cipher</span>: <span class="hljs-string">&#x27;&#x27;</span>,
          <span class="hljs-attr">password</span>: options.<span class="hljs-property">serviceKeyPassword</span>,
          <span class="hljs-attr">passType</span>: <span class="hljs-string">&#x27;in&#x27;</span>
        }, params, delTempPWFiles)
      }
      tmpfiles.<span class="hljs-title function_">push</span>(options.<span class="hljs-property">serviceCertificate</span>)
      tmpfiles.<span class="hljs-title function_">push</span>(options.<span class="hljs-property">serviceKey</span>)
    } <span class="hljs-keyword">else</span> {
      params.<span class="hljs-title function_">push</span>(<span class="hljs-string">&#x27;-signkey&#x27;</span>)
      params.<span class="hljs-title function_">push</span>(<span class="hljs-string">&#x27;--TMPFILE--&#x27;</span>)
      <span class="hljs-keyword">if</span> (options.<span class="hljs-property">serviceKeyPassword</span>) {
        helper.<span class="hljs-title function_">createPasswordFile</span>({
          <span class="hljs-attr">cipher</span>: <span class="hljs-string">&#x27;&#x27;</span>,
          <span class="hljs-attr">password</span>: options.<span class="hljs-property">serviceKeyPassword</span>,
          <span class="hljs-attr">passType</span>: <span class="hljs-string">&#x27;in&#x27;</span>
        }, params, delTempPWFiles)
      }
      tmpfiles.<span class="hljs-title function_">push</span>(options.<span class="hljs-property">serviceKey</span>)
    }

    <span class="hljs-keyword">if</span> (options.<span class="hljs-property">config</span>) {
      params.<span class="hljs-title function_">push</span>(<span class="hljs-string">&#x27;-extensions&#x27;</span>)
      params.<span class="hljs-title function_">push</span>(<span class="hljs-string">&#x27;v3_req&#x27;</span>)
      params.<span class="hljs-title function_">push</span>(<span class="hljs-string">&#x27;-extfile&#x27;</span>)
      params.<span class="hljs-title function_">push</span>(<span class="hljs-string">&#x27;--TMPFILE--&#x27;</span>)
      tmpfiles.<span class="hljs-title function_">push</span>(options.<span class="hljs-property">config</span>)
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (options.<span class="hljs-property">extFile</span>) {
      params.<span class="hljs-title function_">push</span>(<span class="hljs-string">&#x27;-extfile&#x27;</span>)
      params.<span class="hljs-title function_">push</span>(options.<span class="hljs-property">extFile</span>)
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">var</span> altNamesRep = []
      <span class="hljs-keyword">if</span> (data2 &amp;&amp; data2.<span class="hljs-property">san</span>) {
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; data2.<span class="hljs-property">san</span>.<span class="hljs-property">dns</span>.<span class="hljs-property">length</span>; i++) {
          altNamesRep.<span class="hljs-title function_">push</span>(<span class="hljs-string">&#x27;DNS&#x27;</span> + <span class="hljs-string">&#x27;.&#x27;</span> + (i + <span class="hljs-number">1</span>) + <span class="hljs-string">&#x27; = &#x27;</span> + data2.<span class="hljs-property">san</span>.<span class="hljs-property">dns</span>[i])
        }
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i2 = <span class="hljs-number">0</span>; i2 &lt; data2.<span class="hljs-property">san</span>.<span class="hljs-property">ip</span>.<span class="hljs-property">length</span>; i2++) {
          altNamesRep.<span class="hljs-title function_">push</span>(<span class="hljs-string">&#x27;IP&#x27;</span> + <span class="hljs-string">&#x27;.&#x27;</span> + (i2 + <span class="hljs-number">1</span>) + <span class="hljs-string">&#x27; = &#x27;</span> + data2.<span class="hljs-property">san</span>.<span class="hljs-property">ip</span>[i2])
        }
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i3 = <span class="hljs-number">0</span>; i3 &lt; data2.<span class="hljs-property">san</span>.<span class="hljs-property">email</span>.<span class="hljs-property">length</span>; i3++) {
          altNamesRep.<span class="hljs-title function_">push</span>(<span class="hljs-string">&#x27;email&#x27;</span> + <span class="hljs-string">&#x27;.&#x27;</span> + (i3 + <span class="hljs-number">1</span>) + <span class="hljs-string">&#x27; = &#x27;</span> + data2.<span class="hljs-property">san</span>.<span class="hljs-property">email</span>[i3])
        }
        params.<span class="hljs-title function_">push</span>(<span class="hljs-string">&#x27;-extensions&#x27;</span>)
        params.<span class="hljs-title function_">push</span>(<span class="hljs-string">&#x27;v3_req&#x27;</span>)
        params.<span class="hljs-title function_">push</span>(<span class="hljs-string">&#x27;-extfile&#x27;</span>)
        params.<span class="hljs-title function_">push</span>(<span class="hljs-string">&#x27;--TMPFILE--&#x27;</span>)
        tmpfiles.<span class="hljs-title function_">push</span>([
          <span class="hljs-string">&#x27;[v3_req]&#x27;</span>,
          <span class="hljs-string">&#x27;subjectAltName = @alt_names&#x27;</span>,
          <span class="hljs-string">&#x27;[alt_names]&#x27;</span>,
          altNamesRep.<span class="hljs-title function_">join</span>(<span class="hljs-string">&#x27;\n&#x27;</span>)
        ].<span class="hljs-title function_">join</span>(<span class="hljs-string">&#x27;\n&#x27;</span>))
      }
    }

    <span class="hljs-keyword">if</span> (options.<span class="hljs-property">clientKeyPassword</span>) {
      helper.<span class="hljs-title function_">createPasswordFile</span>({
        <span class="hljs-attr">cipher</span>: <span class="hljs-string">&#x27;&#x27;</span>,
        <span class="hljs-attr">password</span>: options.<span class="hljs-property">clientKeyPassword</span>,
        <span class="hljs-attr">passType</span>: <span class="hljs-string">&#x27;in&#x27;</span>
      }, params, delTempPWFiles)
    }

    openssl.<span class="hljs-title function_">exec</span>(params, <span class="hljs-string">&#x27;CERTIFICATE&#x27;</span>, tmpfiles, <span class="hljs-keyword">function</span> (<span class="hljs-params">sslErr, data</span>) {
      <span class="hljs-keyword">function</span> <span class="hljs-title function_">done</span>(<span class="hljs-params">err</span>) {
        <span class="hljs-keyword">if</span> (err) {
          <span class="hljs-keyword">return</span> <span class="hljs-title function_">callback</span>(err)
        }
        <span class="hljs-keyword">var</span> response = {
          <span class="hljs-attr">csr</span>: options.<span class="hljs-property">csr</span>,
          <span class="hljs-attr">clientKey</span>: options.<span class="hljs-property">clientKey</span>,
          <span class="hljs-attr">certificate</span>: data,
          <span class="hljs-attr">serviceKey</span>: options.<span class="hljs-property">serviceKey</span>
        }
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">callback</span>(<span class="hljs-literal">null</span>, response)
      }

      helper.<span class="hljs-title function_">deleteTempFiles</span>(delTempPWFiles, <span class="hljs-keyword">function</span> (<span class="hljs-params">fsErr</span>) {
        <span class="hljs-title function_">done</span>(sslErr || fsErr)
      })
    })
  })
}

<span class="hljs-comment">/**
 * Exports a public key from a private key, CSR or certificate
 * <span class="hljs-doctag">@static</span>
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">String</span>} certificate PEM encoded private key, CSR or certificate
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Function</span>} callback Callback function with an error object and {publicKey}
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">getPublicKey</span>(<span class="hljs-params">certificate, callback</span>) {
  <span class="hljs-keyword">if</span> (!callback &amp;&amp; <span class="hljs-keyword">typeof</span> certificate === <span class="hljs-string">&#x27;function&#x27;</span>) {
    callback = certificate
    certificate = <span class="hljs-literal">undefined</span>
  }

  certificate = (certificate || <span class="hljs-string">&#x27;&#x27;</span>).<span class="hljs-title function_">toString</span>()

  <span class="hljs-keyword">var</span> params

  <span class="hljs-keyword">if</span> (certificate.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/BEGIN(\sNEW)? CERTIFICATE REQUEST/</span>)) {
    params = [<span class="hljs-string">&#x27;req&#x27;</span>,
      <span class="hljs-string">&#x27;-in&#x27;</span>,
      <span class="hljs-string">&#x27;--TMPFILE--&#x27;</span>,
      <span class="hljs-string">&#x27;-pubkey&#x27;</span>,
      <span class="hljs-string">&#x27;-noout&#x27;</span>
    ]
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (certificate.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/BEGIN RSA PRIVATE KEY/</span>) || certificate.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/BEGIN PRIVATE KEY/</span>)) {
    params = [<span class="hljs-string">&#x27;rsa&#x27;</span>,
      <span class="hljs-string">&#x27;-in&#x27;</span>,
      <span class="hljs-string">&#x27;--TMPFILE--&#x27;</span>,
      <span class="hljs-string">&#x27;-pubout&#x27;</span>
    ]
  } <span class="hljs-keyword">else</span> {
    params = [<span class="hljs-string">&#x27;x509&#x27;</span>,
      <span class="hljs-string">&#x27;-in&#x27;</span>,
      <span class="hljs-string">&#x27;--TMPFILE--&#x27;</span>,
      <span class="hljs-string">&#x27;-pubkey&#x27;</span>,
      <span class="hljs-string">&#x27;-noout&#x27;</span>
    ]
  }

  openssl.<span class="hljs-title function_">exec</span>(params, <span class="hljs-string">&#x27;PUBLIC KEY&#x27;</span>, certificate, <span class="hljs-keyword">function</span> (<span class="hljs-params">error, key</span>) {
    <span class="hljs-keyword">if</span> (error) {
      <span class="hljs-keyword">return</span> <span class="hljs-title function_">callback</span>(error)
    }
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">callback</span>(<span class="hljs-literal">null</span>, {
      <span class="hljs-attr">publicKey</span>: key
    })
  })
}

<span class="hljs-comment">/**
 * Reads subject data from a certificate or a CSR
 * <span class="hljs-doctag">@static</span>
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">String</span>} certificate PEM encoded CSR or certificate
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Function</span>} callback Callback function with an error object and {country, state, locality, organization, organizationUnit, commonName, emailAddress}
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">readCertificateInfo</span>(<span class="hljs-params">certificate, callback</span>) {
  <span class="hljs-keyword">if</span> (!callback &amp;&amp; <span class="hljs-keyword">typeof</span> certificate === <span class="hljs-string">&#x27;function&#x27;</span>) {
    callback = certificate
    certificate = <span class="hljs-literal">undefined</span>
  }

  certificate = (certificate || <span class="hljs-string">&#x27;&#x27;</span>).<span class="hljs-title function_">toString</span>()
  <span class="hljs-keyword">var</span> isMatch = certificate.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/BEGIN(\sNEW)? CERTIFICATE REQUEST/</span>)
  <span class="hljs-keyword">var</span> type = isMatch ? <span class="hljs-string">&#x27;req&#x27;</span> : <span class="hljs-string">&#x27;x509&#x27;</span>
  <span class="hljs-keyword">var</span> params = [type,
    <span class="hljs-string">&#x27;-noout&#x27;</span>,
    <span class="hljs-string">&#x27;-nameopt&#x27;</span>,
    <span class="hljs-string">&#x27;RFC2253,sep_multiline,space_eq,-esc_msb,utf8&#x27;</span>,
    <span class="hljs-string">&#x27;-text&#x27;</span>,
    <span class="hljs-string">&#x27;-in&#x27;</span>,
    <span class="hljs-string">&#x27;--TMPFILE--&#x27;</span>
  ]
  openssl.<span class="hljs-title function_">spawnWrapper</span>(params, certificate, <span class="hljs-keyword">function</span> (<span class="hljs-params">err, code, stdout, stderr</span>) {
    <span class="hljs-keyword">if</span> (err) {
      <span class="hljs-keyword">return</span> <span class="hljs-title function_">callback</span>(err)
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (stderr) {
      <span class="hljs-keyword">return</span> <span class="hljs-title function_">callback</span>(stderr)
    }
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">fetchCertificateData</span>(stdout, callback)
  })
}

<span class="hljs-comment">/**
 * get the modulus from a certificate, a CSR or a private key
 * <span class="hljs-doctag">@static</span>
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">String</span>} certificate PEM encoded, CSR PEM encoded, or private key
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">String</span>} [password] password for the certificate
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">String</span>} [hash] hash function to use (up to now `md5` supported) (default: none)
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Function</span>} callback Callback function with an error object and {modulus}
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">getModulus</span>(<span class="hljs-params">certificate, password, hash, callback</span>) {
  <span class="hljs-keyword">if</span> (!callback &amp;&amp; !hash &amp;&amp; <span class="hljs-keyword">typeof</span> password === <span class="hljs-string">&#x27;function&#x27;</span>) {
    callback = password
    password = <span class="hljs-literal">undefined</span>
    hash = <span class="hljs-literal">false</span>
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!callback &amp;&amp; hash &amp;&amp; <span class="hljs-keyword">typeof</span> hash === <span class="hljs-string">&#x27;function&#x27;</span>) {
    callback = hash
    hash = <span class="hljs-literal">false</span></pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-4">&#x00a7;</a>
              </div>
              <p>password will be falsy if not provided</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  }</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-5">&#x00a7;</a>
              </div>
              <p>adding hash function to params, is not supported by openssl.
process piping would be the right way (… | openssl md5)
No idea how this can be achieved in easy with the current build in methods
of pem.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span> (hash &amp;&amp; hash !== <span class="hljs-string">&#x27;md5&#x27;</span>) {
    hash = <span class="hljs-literal">false</span>
  }

  certificate = (<span class="hljs-title class_">Buffer</span>.<span class="hljs-title function_">isBuffer</span>(certificate) &amp;&amp; certificate.<span class="hljs-title function_">toString</span>()) || certificate

  <span class="hljs-keyword">let</span> type
  <span class="hljs-keyword">if</span> (certificate.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/BEGIN(\sNEW)? CERTIFICATE REQUEST/</span>)) {
    type = <span class="hljs-string">&#x27;req&#x27;</span>
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (certificate.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/BEGIN RSA PRIVATE KEY/</span>) || certificate.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/BEGIN PRIVATE KEY/</span>)) {
    type = <span class="hljs-string">&#x27;rsa&#x27;</span>
  } <span class="hljs-keyword">else</span> {
    type = <span class="hljs-string">&#x27;x509&#x27;</span>
  }
  <span class="hljs-keyword">let</span> params = [
    type,
    <span class="hljs-string">&#x27;-noout&#x27;</span>,
    <span class="hljs-string">&#x27;-modulus&#x27;</span>,
    <span class="hljs-string">&#x27;-in&#x27;</span>,
    <span class="hljs-string">&#x27;--TMPFILE--&#x27;</span>
  ]
  <span class="hljs-keyword">let</span> delTempPWFiles = []
  <span class="hljs-keyword">if</span> (password) {
    helper.<span class="hljs-title function_">createPasswordFile</span>({<span class="hljs-attr">cipher</span>: <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-attr">password</span>: password, <span class="hljs-attr">passType</span>: <span class="hljs-string">&#x27;in&#x27;</span>}, params, delTempPWFiles)
  }

  openssl.<span class="hljs-title function_">spawnWrapper</span>(params, certificate, <span class="hljs-keyword">function</span> (<span class="hljs-params">sslErr, code, stdout, stderr</span>) {
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">done</span>(<span class="hljs-params">err</span>) {
      <span class="hljs-keyword">if</span> (err) {
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">callback</span>(err)
      }
      <span class="hljs-keyword">var</span> match = stdout.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/Modulus=([0-9a-fA-F]+)$/m</span>)
      <span class="hljs-keyword">if</span> (match) {
        <span class="hljs-keyword">if</span> (hash === <span class="hljs-string">&#x27;md5&#x27;</span>) {
          <span class="hljs-keyword">return</span> <span class="hljs-title function_">callback</span>(<span class="hljs-literal">null</span>, {
            <span class="hljs-attr">modulus</span>: <span class="hljs-title function_">hash_md5</span>(match[<span class="hljs-number">1</span>])
          })
        }

        <span class="hljs-keyword">return</span> <span class="hljs-title function_">callback</span>(<span class="hljs-literal">null</span>, {
          <span class="hljs-attr">modulus</span>: match[<span class="hljs-number">1</span>]
        })

      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">callback</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;No modulus&#x27;</span>))
      }
    }

    helper.<span class="hljs-title function_">deleteTempFiles</span>(delTempPWFiles, <span class="hljs-keyword">function</span> (<span class="hljs-params">fsErr</span>) {
      <span class="hljs-title function_">done</span>(sslErr || fsErr || stderr)
    })
  })
}

<span class="hljs-comment">/**
 * get the size and prime of DH parameters
 * <span class="hljs-doctag">@static</span>
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">String</span>} dh parameters PEM encoded
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Function</span>} callback Callback function with an error object and {size, prime}
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">getDhparamInfo</span>(<span class="hljs-params">dh, callback</span>) {
  dh = (<span class="hljs-title class_">Buffer</span>.<span class="hljs-title function_">isBuffer</span>(dh) &amp;&amp; dh.<span class="hljs-title function_">toString</span>()) || dh

  <span class="hljs-keyword">var</span> params = [
    <span class="hljs-string">&#x27;dhparam&#x27;</span>,
    <span class="hljs-string">&#x27;-text&#x27;</span>,
    <span class="hljs-string">&#x27;-in&#x27;</span>,
    <span class="hljs-string">&#x27;--TMPFILE--&#x27;</span>
  ]

  openssl.<span class="hljs-title function_">spawnWrapper</span>(params, dh, <span class="hljs-keyword">function</span> (<span class="hljs-params">err, code, stdout, stderr</span>) {
    <span class="hljs-keyword">if</span> (err) {
      <span class="hljs-keyword">return</span> <span class="hljs-title function_">callback</span>(err)
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (stderr) {
      <span class="hljs-keyword">return</span> <span class="hljs-title function_">callback</span>(stderr)
    }

    <span class="hljs-keyword">var</span> result = {}
    <span class="hljs-keyword">var</span> match = stdout.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/Parameters: \((\d+) bit\)/</span>)

    <span class="hljs-keyword">if</span> (match) {
      result.<span class="hljs-property">size</span> = <span class="hljs-title class_">Number</span>(match[<span class="hljs-number">1</span>])
    }

    <span class="hljs-keyword">var</span> prime = <span class="hljs-string">&#x27;&#x27;</span>
    stdout.<span class="hljs-title function_">split</span>(<span class="hljs-string">&#x27;\n&#x27;</span>).<span class="hljs-title function_">forEach</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">line</span>) {
      <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/\s+([0-9a-f][0-9a-f]:)+[0-9a-f]?[0-9a-f]?/g</span>.<span class="hljs-title function_">test</span>(line)) {
        prime += line.<span class="hljs-title function_">trim</span>()
      }
    })

    <span class="hljs-keyword">if</span> (prime) {
      result.<span class="hljs-property">prime</span> = prime
    }

    <span class="hljs-keyword">if</span> (!match &amp;&amp; !prime) {
      <span class="hljs-keyword">return</span> <span class="hljs-title function_">callback</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;No DH info found&#x27;</span>))
    }

    <span class="hljs-keyword">return</span> <span class="hljs-title function_">callback</span>(<span class="hljs-literal">null</span>, result)
  })
}

<span class="hljs-comment">/**
 * config the pem module
 * <span class="hljs-doctag">@static</span>
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Object</span>} <span class="hljs-variable">options</span>
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">config</span>(<span class="hljs-params">options</span>) {
  <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(options).<span class="hljs-title function_">forEach</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">k</span>) {
    openssl.<span class="hljs-title function_">set</span>(k, options[k])
  })
}

<span class="hljs-comment">/**
 * Gets the fingerprint for a certificate
 * <span class="hljs-doctag">@static</span>
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">String</span>} certificate PEM encoded certificate
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">String</span>} [hash] hash function to use (either `md5`, `sha1` or `sha256`, defaults to `sha1`)
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Function</span>} callback Callback function with an error object and {fingerprint}
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">getFingerprint</span>(<span class="hljs-params">certificate, hash, callback</span>) {
  <span class="hljs-keyword">if</span> (!callback &amp;&amp; <span class="hljs-keyword">typeof</span> hash === <span class="hljs-string">&#x27;function&#x27;</span>) {
    callback = hash
    hash = <span class="hljs-literal">undefined</span>
  }

  hash = hash || <span class="hljs-string">&#x27;sha1&#x27;</span>

  <span class="hljs-keyword">var</span> params = [<span class="hljs-string">&#x27;x509&#x27;</span>,
    <span class="hljs-string">&#x27;-in&#x27;</span>,
    <span class="hljs-string">&#x27;--TMPFILE--&#x27;</span>,
    <span class="hljs-string">&#x27;-fingerprint&#x27;</span>,
    <span class="hljs-string">&#x27;-noout&#x27;</span>,
    <span class="hljs-string">&#x27;-&#x27;</span> + hash
  ]

  openssl.<span class="hljs-title function_">spawnWrapper</span>(params, certificate, <span class="hljs-keyword">function</span> (<span class="hljs-params">err, code, stdout, stderr</span>) {
    <span class="hljs-keyword">if</span> (err) {
      <span class="hljs-keyword">return</span> <span class="hljs-title function_">callback</span>(err)
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (stderr) {
      <span class="hljs-keyword">return</span> <span class="hljs-title function_">callback</span>(stderr)
    }
    <span class="hljs-keyword">var</span> match = stdout.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/Fingerprint=([0-9a-fA-F:]+)$/m</span>)
    <span class="hljs-keyword">if</span> (match) {
      <span class="hljs-keyword">return</span> <span class="hljs-title function_">callback</span>(<span class="hljs-literal">null</span>, {
        <span class="hljs-attr">fingerprint</span>: match[<span class="hljs-number">1</span>]
      })
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">return</span> <span class="hljs-title function_">callback</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;No fingerprint&#x27;</span>))
    }
  })
}

<span class="hljs-comment">/**
 * Export private key and certificate to a PKCS12 keystore
 * <span class="hljs-doctag">@static</span>
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">String</span>} key PEM encoded private key
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">String</span>} certificate PEM encoded certificate
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">String</span>} password Password of the result PKCS12 file
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Object</span>} [options] object of cipher and optional client key password {cipher:&#x27;aes128&#x27;, clientKeyPassword: &#x27;xxxx&#x27;, certFiles: [&#x27;file1&#x27;,&#x27;file2&#x27;]}
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Function</span>} callback Callback function with an error object and {pkcs12}
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">createPkcs12</span>(<span class="hljs-params">key, certificate, password, options, callback</span>) {
  <span class="hljs-keyword">if</span> (!callback &amp;&amp; <span class="hljs-keyword">typeof</span> options === <span class="hljs-string">&#x27;function&#x27;</span>) {
    callback = options
    options = {}
  }

  <span class="hljs-keyword">var</span> params = [<span class="hljs-string">&#x27;pkcs12&#x27;</span>, <span class="hljs-string">&#x27;-export&#x27;</span>]
  <span class="hljs-keyword">var</span> delTempPWFiles = []

  <span class="hljs-keyword">if</span> (options.<span class="hljs-property">cipher</span> &amp;&amp; options.<span class="hljs-property">clientKeyPassword</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-6">&#x00a7;</a>
              </div>
              <p>NOTICE: The password field is needed! self if it is empty.
create password file for the import “-passin”</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    helper.<span class="hljs-title function_">createPasswordFile</span>({
      <span class="hljs-attr">cipher</span>: options.<span class="hljs-property">cipher</span>,
      <span class="hljs-attr">password</span>: options.<span class="hljs-property">clientKeyPassword</span>,
      <span class="hljs-attr">passType</span>: <span class="hljs-string">&#x27;in&#x27;</span>
    }, params, delTempPWFiles)
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-7">&#x00a7;</a>
              </div>
              <p>NOTICE: The password field is needed! self if it is empty.
create password file for the password “-password”</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  helper.<span class="hljs-title function_">createPasswordFile</span>({<span class="hljs-attr">cipher</span>: <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-attr">password</span>: password, <span class="hljs-attr">passType</span>: <span class="hljs-string">&#x27;word&#x27;</span>}, params, delTempPWFiles)

  params.<span class="hljs-title function_">push</span>(<span class="hljs-string">&#x27;-in&#x27;</span>)
  params.<span class="hljs-title function_">push</span>(<span class="hljs-string">&#x27;--TMPFILE--&#x27;</span>)
  params.<span class="hljs-title function_">push</span>(<span class="hljs-string">&#x27;-inkey&#x27;</span>)
  params.<span class="hljs-title function_">push</span>(<span class="hljs-string">&#x27;--TMPFILE--&#x27;</span>)

  <span class="hljs-keyword">var</span> tmpfiles = [certificate, key]

  <span class="hljs-keyword">if</span> (options.<span class="hljs-property">certFiles</span>) {
    tmpfiles.<span class="hljs-title function_">push</span>(options.<span class="hljs-property">certFiles</span>.<span class="hljs-title function_">join</span>(<span class="hljs-string">&#x27;&#x27;</span>))

    params.<span class="hljs-title function_">push</span>(<span class="hljs-string">&#x27;-certfile&#x27;</span>)
    params.<span class="hljs-title function_">push</span>(<span class="hljs-string">&#x27;--TMPFILE--&#x27;</span>)
  }

  openssl.<span class="hljs-title function_">execBinary</span>(params, tmpfiles, <span class="hljs-keyword">function</span> (<span class="hljs-params">sslErr, pkcs12</span>) {
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">done</span>(<span class="hljs-params">err</span>) {
      <span class="hljs-keyword">if</span> (err) {
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">callback</span>(err)
      }
      <span class="hljs-keyword">return</span> <span class="hljs-title function_">callback</span>(<span class="hljs-literal">null</span>, {
        <span class="hljs-attr">pkcs12</span>: pkcs12
      })
    }

    helper.<span class="hljs-title function_">deleteTempFiles</span>(delTempPWFiles, <span class="hljs-keyword">function</span> (<span class="hljs-params">fsErr</span>) {
      <span class="hljs-title function_">done</span>(sslErr || fsErr)
    })
  })
}

<span class="hljs-comment">/**
 * read sslcert data from Pkcs12 file. Results are provided in callback response in object notation ({cert: .., ca:..., key:...})
 * <span class="hljs-doctag">@static</span>
 * <span class="hljs-doctag">@param</span>  {<span class="hljs-type">Buffer|String</span>}   bufferOrPath Buffer or path to file
 * <span class="hljs-doctag">@param</span>  {<span class="hljs-type">Object</span>}   [options]      openssl options
 * <span class="hljs-doctag">@param</span>  {<span class="hljs-type">Function</span>} callback     Called with error object and sslcert bundle object
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">readPkcs12</span>(<span class="hljs-params">bufferOrPath, options, callback</span>) {
  <span class="hljs-keyword">if</span> (!callback &amp;&amp; <span class="hljs-keyword">typeof</span> options === <span class="hljs-string">&#x27;function&#x27;</span>) {
    callback = options
    options = {}
  }

  options.<span class="hljs-property">p12Password</span> = options.<span class="hljs-property">p12Password</span> || <span class="hljs-string">&#x27;&#x27;</span>

  <span class="hljs-keyword">var</span> tmpfiles = []
  <span class="hljs-keyword">var</span> delTempPWFiles = []
  <span class="hljs-keyword">var</span> args = [<span class="hljs-string">&#x27;pkcs12&#x27;</span>, <span class="hljs-string">&#x27;-in&#x27;</span>, bufferOrPath]

  helper.<span class="hljs-title function_">createPasswordFile</span>({<span class="hljs-attr">cipher</span>: <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-attr">password</span>: options.<span class="hljs-property">p12Password</span>, <span class="hljs-attr">passType</span>: <span class="hljs-string">&#x27;in&#x27;</span>}, args, delTempPWFiles)

  <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Buffer</span>.<span class="hljs-title function_">isBuffer</span>(bufferOrPath)) {
    tmpfiles = [bufferOrPath]
    args[<span class="hljs-number">2</span>] = <span class="hljs-string">&#x27;--TMPFILE--&#x27;</span>
  }

  <span class="hljs-keyword">if</span> (openssl.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;Vendor&#x27;</span>) === <span class="hljs-string">&quot;OPENSSL&quot;</span> &amp;&amp; openssl.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;VendorVersionMajor&#x27;</span>) &gt;= <span class="hljs-number">3</span>) {
    args.<span class="hljs-title function_">push</span>(<span class="hljs-string">&#x27;-legacy&#x27;</span>)
    args.<span class="hljs-title function_">push</span>(<span class="hljs-string">&#x27;-traditional&#x27;</span>)
  }

  <span class="hljs-keyword">if</span> (options.<span class="hljs-property">clientKeyPassword</span>) {
    helper.<span class="hljs-title function_">createPasswordFile</span>({
      <span class="hljs-attr">cipher</span>: <span class="hljs-string">&#x27;&#x27;</span>,
      <span class="hljs-attr">password</span>: options.<span class="hljs-property">clientKeyPassword</span>,
      <span class="hljs-attr">passType</span>: <span class="hljs-string">&#x27;out&#x27;</span>
    }, args, delTempPWFiles)
  } <span class="hljs-keyword">else</span> {
    args.<span class="hljs-title function_">push</span>(<span class="hljs-string">&#x27;-nodes&#x27;</span>)
  }

  openssl.<span class="hljs-title function_">execBinary</span>(args, tmpfiles, <span class="hljs-keyword">function</span> (<span class="hljs-params">sslErr, stdout</span>) {
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">done</span>(<span class="hljs-params">err</span>) {
      <span class="hljs-keyword">var</span> keybundle = {}

      <span class="hljs-keyword">if</span> (err &amp;&amp; err.<span class="hljs-property">message</span>.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">&#x27;No such file or directory&#x27;</span>) !== -<span class="hljs-number">1</span>) {
        err.<span class="hljs-property">code</span> = <span class="hljs-string">&#x27;ENOENT&#x27;</span>
      }

      <span class="hljs-keyword">if</span> (!err) {
        <span class="hljs-keyword">var</span> certs = <span class="hljs-title function_">readFromString</span>(stdout, <span class="hljs-variable constant_">CERT_START</span>, <span class="hljs-variable constant_">CERT_END</span>)
        keybundle.<span class="hljs-property">cert</span> = certs.<span class="hljs-title function_">shift</span>()
        keybundle.<span class="hljs-property">ca</span> = certs
        keybundle.<span class="hljs-property">key</span> = <span class="hljs-title function_">readFromString</span>(stdout, <span class="hljs-variable constant_">KEY_START</span>, <span class="hljs-variable constant_">KEY_END</span>).<span class="hljs-title function_">pop</span>()

        <span class="hljs-title function_">debug</span>(<span class="hljs-string">&quot;readPkcs12.execBinary - PRIVATE KEY - ?: &quot;</span>, keybundle.<span class="hljs-property">key</span>)
        <span class="hljs-keyword">if</span> (keybundle.<span class="hljs-property">key</span>) {
          <span class="hljs-keyword">var</span> args = [<span class="hljs-string">&#x27;rsa&#x27;</span>];
          <span class="hljs-keyword">if</span> (openssl.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;Vendor&#x27;</span>) === <span class="hljs-string">&quot;OPENSSL&quot;</span> &amp;&amp; openssl.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;VendorVersionMajor&#x27;</span>) &gt;= <span class="hljs-number">3</span>) {
            args.<span class="hljs-title function_">push</span>(<span class="hljs-string">&#x27;-traditional&#x27;</span>)
          }
          args.<span class="hljs-title function_">push</span>(<span class="hljs-string">&#x27;-in&#x27;</span>);
          args.<span class="hljs-title function_">push</span>(<span class="hljs-string">&#x27;--TMPFILE--&#x27;</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-8">&#x00a7;</a>
              </div>
              <p>convert to RSA key</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-keyword">return</span> openssl.<span class="hljs-title function_">exec</span>(args, <span class="hljs-string">&#x27;(RSA |)PRIVATE KEY&#x27;</span>, [keybundle.<span class="hljs-property">key</span>], <span class="hljs-keyword">function</span> (<span class="hljs-params">err, key</span>) {
            <span class="hljs-keyword">if</span> (err) {
              <span class="hljs-title function_">debug</span>(<span class="hljs-string">&quot;readPkcs12.execBinary - PRIVATE KEY convert - error: &quot;</span>, err)
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-9">&#x00a7;</a>
              </div>
              <p>debug(“readPkcs12.execBinary - PRIVATE KEY”, key)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            keybundle.<span class="hljs-property">key</span> = key

            <span class="hljs-keyword">return</span> <span class="hljs-title function_">callback</span>(err, keybundle)
          })
        }

        <span class="hljs-keyword">if</span> (options.<span class="hljs-property">clientKeyPassword</span>) {
          keybundle.<span class="hljs-property">key</span> = <span class="hljs-title function_">readFromString</span>(stdout, <span class="hljs-variable constant_">ENCRYPTED_KEY_START</span>, <span class="hljs-variable constant_">ENCRYPTED_KEY_END</span>).<span class="hljs-title function_">pop</span>()
          <span class="hljs-title function_">debug</span>(<span class="hljs-string">&quot;readPkcs12.execBinary - ENCRYPTED PRIVATE KEY - ?: &quot;</span>, keybundle.<span class="hljs-property">key</span>)
          <span class="hljs-comment">/*return openssl.exec([&#x27;rsa&#x27;, &#x27;-in&#x27;, &#x27;--TMPFILE--&#x27;], &#x27;RSA PRIVATE KEY&#x27;, [keybundle.key], function (err, key) {
            if (err) {
              debug(&quot;readPkcs12.execBinary - ENCRYPTED PRIVATE KEY - error: &quot;, err)
            }
            debug(&quot;readPkcs12.execBinary - ENCRYPTED PRIVATE KEY&quot;, key)
            keybundle.key = key

            return callback(err, keybundle)
          })*/</span>
        } <span class="hljs-keyword">else</span> {
          keybundle.<span class="hljs-property">key</span> = <span class="hljs-title function_">readFromString</span>(stdout, <span class="hljs-variable constant_">RSA_KEY_START</span>, <span class="hljs-variable constant_">RSA_KEY_END</span>).<span class="hljs-title function_">pop</span>()
          <span class="hljs-title function_">debug</span>(<span class="hljs-string">&quot;readPkcs12.execBinary - RSA PRIVATE KEY - ?: &quot;</span>, keybundle.<span class="hljs-property">key</span>)
          <span class="hljs-comment">/*return openssl.exec([&#x27;rsa&#x27;, &#x27;-in&#x27;, &#x27;--TMPFILE--&#x27;], &#x27;RSA PRIVATE KEY&#x27;, [keybundle.key], function (err, key) {
            if (err) {
              debug(&quot;readPkcs12.execBinary - RSA PRIVATE KEY - error: &quot;, err)
            }
            debug(&quot;readPkcs12.execBinary - RSA PRIVATE KEY&quot;, key)
            keybundle.key = key

            return callback(err, keybundle)
          })*/</span>
        }
      }

      <span class="hljs-keyword">return</span> <span class="hljs-title function_">callback</span>(err, keybundle)
    }

    helper.<span class="hljs-title function_">deleteTempFiles</span>(delTempPWFiles, <span class="hljs-keyword">function</span> (<span class="hljs-params">fsErr</span>) {
      <span class="hljs-title function_">done</span>(sslErr || fsErr)
    })
  })
}

<span class="hljs-comment">/**
 * Check a certificate
 * <span class="hljs-doctag">@static</span>
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">String</span>} certificate PEM encoded certificate
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">String</span>} [passphrase] password for the certificate
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Function</span>} callback Callback function with an error object and a boolean valid
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">checkCertificate</span>(<span class="hljs-params">certificate, passphrase, callback</span>) {
  <span class="hljs-keyword">var</span> params
  <span class="hljs-keyword">var</span> delTempPWFiles = []

  <span class="hljs-keyword">if</span> (!callback &amp;&amp; <span class="hljs-keyword">typeof</span> passphrase === <span class="hljs-string">&#x27;function&#x27;</span>) {
    callback = passphrase
    passphrase = <span class="hljs-literal">undefined</span>
  }
  certificate = (certificate || <span class="hljs-string">&#x27;&#x27;</span>).<span class="hljs-title function_">toString</span>()

  <span class="hljs-keyword">if</span> (certificate.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/BEGIN(\sNEW)? CERTIFICATE REQUEST/</span>)) {
    params = [<span class="hljs-string">&#x27;req&#x27;</span>, <span class="hljs-string">&#x27;-text&#x27;</span>, <span class="hljs-string">&#x27;-noout&#x27;</span>, <span class="hljs-string">&#x27;-verify&#x27;</span>, <span class="hljs-string">&#x27;-in&#x27;</span>, <span class="hljs-string">&#x27;--TMPFILE--&#x27;</span>]
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (certificate.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/BEGIN RSA PRIVATE KEY/</span>) || certificate.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/BEGIN PRIVATE KEY/</span>)) {
    params = [<span class="hljs-string">&#x27;rsa&#x27;</span>, <span class="hljs-string">&#x27;-noout&#x27;</span>, <span class="hljs-string">&#x27;-check&#x27;</span>, <span class="hljs-string">&#x27;-in&#x27;</span>, <span class="hljs-string">&#x27;--TMPFILE--&#x27;</span>]
  } <span class="hljs-keyword">else</span> {
    params = [<span class="hljs-string">&#x27;x509&#x27;</span>, <span class="hljs-string">&#x27;-text&#x27;</span>, <span class="hljs-string">&#x27;-noout&#x27;</span>, <span class="hljs-string">&#x27;-in&#x27;</span>, <span class="hljs-string">&#x27;--TMPFILE--&#x27;</span>]
  }
  <span class="hljs-keyword">if</span> (passphrase) {
    helper.<span class="hljs-title function_">createPasswordFile</span>({<span class="hljs-attr">cipher</span>: <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-attr">password</span>: passphrase, <span class="hljs-attr">passType</span>: <span class="hljs-string">&#x27;in&#x27;</span>}, params, delTempPWFiles)
  }

  openssl.<span class="hljs-title function_">spawnWrapper</span>(params, certificate, <span class="hljs-keyword">function</span> (<span class="hljs-params">sslErr, code, stdout, stderr</span>) {
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">done</span>(<span class="hljs-params">err</span>) {

      stdout = stdout &amp;&amp; stdout.<span class="hljs-title function_">trim</span>()
      <span class="hljs-keyword">var</span> result
      <span class="hljs-keyword">switch</span> (params[<span class="hljs-number">0</span>]) {
        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;rsa&#x27;</span>:
          result = <span class="hljs-regexp">/^Rsa key ok$/i</span>.<span class="hljs-title function_">test</span>(stdout)
          <span class="hljs-keyword">break</span>
        <span class="hljs-attr">default</span>:
          result = <span class="hljs-regexp">/Signature Algorithm/im</span>.<span class="hljs-title function_">test</span>(stdout)
          <span class="hljs-keyword">break</span>
      }
      <span class="hljs-keyword">if</span> (!result) {
        <span class="hljs-keyword">if</span> (openssl.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;Vendor&#x27;</span>) === <span class="hljs-string">&quot;OPENSSL&quot;</span> &amp;&amp; openssl.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;VendorVersionMajor&#x27;</span>) &gt;= <span class="hljs-number">3</span>) {
          <span class="hljs-keyword">if</span> (!(stderr &amp;&amp; stderr.<span class="hljs-title function_">toString</span>().<span class="hljs-title function_">trim</span>().<span class="hljs-title function_">endsWith</span>(<span class="hljs-string">&#x27;verify OK&#x27;</span>))) {
            <span class="hljs-keyword">return</span> <span class="hljs-title function_">callback</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(stderr.<span class="hljs-title function_">toString</span>()))
          }
        }
        <span class="hljs-keyword">if</span> (err &amp;&amp; err.<span class="hljs-title function_">toString</span>().<span class="hljs-title function_">trim</span>() !== <span class="hljs-string">&#x27;verify OK&#x27;</span>) {
          <span class="hljs-keyword">return</span> <span class="hljs-title function_">callback</span>(err)
        }
      }
      <span class="hljs-title function_">callback</span>(<span class="hljs-literal">null</span>, result)
    }

    helper.<span class="hljs-title function_">deleteTempFiles</span>(delTempPWFiles, <span class="hljs-keyword">function</span> (<span class="hljs-params">fsErr</span>) {
      <span class="hljs-title function_">done</span>(sslErr || fsErr || stderr)
    })
  })
}

<span class="hljs-comment">/**
 * check a PKCS#12 file (.pfx or.p12)
 * <span class="hljs-doctag">@static</span>
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Buffer|String</span>} bufferOrPath PKCS#12 certificate
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">String</span>} [passphrase] optional passphrase which will be used to open the keystore
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Function</span>} callback Callback function with an error object and a boolean valid
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">checkPkcs12</span>(<span class="hljs-params">bufferOrPath, passphrase, callback</span>) {
  <span class="hljs-keyword">if</span> (!callback &amp;&amp; <span class="hljs-keyword">typeof</span> passphrase === <span class="hljs-string">&#x27;function&#x27;</span>) {
    callback = passphrase
    passphrase = <span class="hljs-string">&#x27;&#x27;</span>
  }

  <span class="hljs-keyword">var</span> tmpfiles = []
  <span class="hljs-keyword">var</span> delTempPWFiles = []
  <span class="hljs-keyword">var</span> args = [<span class="hljs-string">&#x27;pkcs12&#x27;</span>, <span class="hljs-string">&#x27;-info&#x27;</span>, <span class="hljs-string">&#x27;-in&#x27;</span>, bufferOrPath, <span class="hljs-string">&#x27;-noout&#x27;</span>, <span class="hljs-string">&#x27;-maciter&#x27;</span>, <span class="hljs-string">&#x27;-nodes&#x27;</span>]

  helper.<span class="hljs-title function_">createPasswordFile</span>({<span class="hljs-attr">cipher</span>: <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-attr">password</span>: passphrase, <span class="hljs-attr">passType</span>: <span class="hljs-string">&#x27;in&#x27;</span>}, args, delTempPWFiles)

  <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Buffer</span>.<span class="hljs-title function_">isBuffer</span>(bufferOrPath)) {
    tmpfiles = [bufferOrPath]
    args[<span class="hljs-number">3</span>] = <span class="hljs-string">&#x27;--TMPFILE--&#x27;</span>
  }

  <span class="hljs-keyword">if</span> (openssl.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;Vendor&#x27;</span>) === <span class="hljs-string">&quot;OPENSSL&quot;</span> &amp;&amp; openssl.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;VendorVersionMajor&#x27;</span>) &gt;= <span class="hljs-number">3</span>) {
    args.<span class="hljs-title function_">splice</span>(<span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-string">&#x27;-legacy&#x27;</span>);
  }

  openssl.<span class="hljs-title function_">spawnWrapper</span>(args, tmpfiles, <span class="hljs-keyword">function</span> (<span class="hljs-params">sslErr, code, stdout, stderr</span>) {
    <span class="hljs-title function_">debug</span>(<span class="hljs-string">&#x27;checkPkcs12 error&#x27;</span>, {
      <span class="hljs-attr">err</span>: sslErr,
      <span class="hljs-attr">code</span>: code,
      <span class="hljs-attr">stdout</span>: stdout,
      <span class="hljs-attr">stdoutResult</span>: (<span class="hljs-regexp">/MAC verified OK/im</span>.<span class="hljs-title function_">test</span>(stderr) || (!(<span class="hljs-regexp">/MAC verified OK/im</span>.<span class="hljs-title function_">test</span>(stderr)) &amp;&amp; !(<span class="hljs-regexp">/Mac verify error/im</span>.<span class="hljs-title function_">test</span>(stderr)))),
      <span class="hljs-attr">stderr</span>: stderr
    })

    <span class="hljs-keyword">function</span> <span class="hljs-title function_">done</span>(<span class="hljs-params">err</span>) {
      <span class="hljs-keyword">if</span> (err) {
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">callback</span>(err)
      }
      <span class="hljs-title function_">callback</span>(<span class="hljs-literal">null</span>, (<span class="hljs-regexp">/MAC verified OK/im</span>.<span class="hljs-title function_">test</span>(stderr) || (!(<span class="hljs-regexp">/MAC verified OK/im</span>.<span class="hljs-title function_">test</span>(stderr)) &amp;&amp; !(<span class="hljs-regexp">/Mac verify error/im</span>.<span class="hljs-title function_">test</span>(stderr)))))
    }

    helper.<span class="hljs-title function_">deleteTempFiles</span>(delTempPWFiles, <span class="hljs-keyword">function</span> (<span class="hljs-params">fsErr</span>) {
      <span class="hljs-title function_">debug</span>(<span class="hljs-string">&#x27;checkPkcs12 clean-up error&#x27;</span>, {
        <span class="hljs-attr">sslErr</span>: sslErr,
        <span class="hljs-attr">fsErr</span>: fsErr,
        <span class="hljs-attr">code</span>: code,
        <span class="hljs-attr">stdout</span>: stdout,
        <span class="hljs-attr">stdoutResult</span>: (<span class="hljs-regexp">/MAC verified OK/im</span>.<span class="hljs-title function_">test</span>(stderr) || (!(<span class="hljs-regexp">/MAC verified OK/im</span>.<span class="hljs-title function_">test</span>(stderr)) &amp;&amp; !(<span class="hljs-regexp">/Mac verify error/im</span>.<span class="hljs-title function_">test</span>(stderr)))),
        <span class="hljs-attr">stderr</span>: stderr
      })
      <span class="hljs-title function_">done</span>(sslErr || fsErr)
    })
  })
}

<span class="hljs-comment">/**
 * Verifies the signing chain of the passed certificate
 * <span class="hljs-doctag">@static</span>
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">String|Array</span>} certificate PEM encoded certificate include intermediate certificates
 * The correct order of trust chain must be preserved and should start with Leaf
 * certificate. Example array: [Leaf, Int CA 1, ... , Int CA N, Root CA].
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">String|Array</span>} ca [List] of CA certificates
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Function</span>} callback Callback function with an error object and a boolean valid
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">verifySigningChain</span>(<span class="hljs-params">certificate, ca, callback</span>) {
  <span class="hljs-keyword">if</span> (!callback &amp;&amp; <span class="hljs-keyword">typeof</span> ca === <span class="hljs-string">&#x27;function&#x27;</span>) {
    callback = ca
    ca = <span class="hljs-literal">undefined</span>
  }
  <span class="hljs-keyword">if</span> (!<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(certificate)) {
    certificate = <span class="hljs-title function_">readFromString</span>(certificate, <span class="hljs-variable constant_">CERT_START</span>, <span class="hljs-variable constant_">CERT_END</span>)
  }
  <span class="hljs-keyword">if</span> (!<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(ca) &amp;&amp; ca !== <span class="hljs-literal">undefined</span>) {
    <span class="hljs-keyword">if</span> (ca !== <span class="hljs-string">&#x27;&#x27;</span>) {
      ca = [ca]
    }
  }

  <span class="hljs-keyword">var</span> params = [<span class="hljs-string">&#x27;verify&#x27;</span>]
  <span class="hljs-keyword">var</span> files = []

  <span class="hljs-keyword">if</span> (ca !== <span class="hljs-literal">undefined</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-10">&#x00a7;</a>
              </div>
              <p>ca certificates</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    params.<span class="hljs-title function_">push</span>(<span class="hljs-string">&#x27;-CAfile&#x27;</span>)
    params.<span class="hljs-title function_">push</span>(<span class="hljs-string">&#x27;--TMPFILE--&#x27;</span>)
    files.<span class="hljs-title function_">push</span>(ca.<span class="hljs-title function_">join</span>(<span class="hljs-string">&#x27;\n&#x27;</span>))
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-11">&#x00a7;</a>
              </div>
              <p>extracting the very first - leaf - cert in chain</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> leaf = certificate.<span class="hljs-title function_">shift</span>()

  <span class="hljs-keyword">if</span> (certificate.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
    params.<span class="hljs-title function_">push</span>(<span class="hljs-string">&#x27;-untrusted&#x27;</span>)
    params.<span class="hljs-title function_">push</span>(<span class="hljs-string">&#x27;--TMPFILE--&#x27;</span>)
    files.<span class="hljs-title function_">push</span>(certificate.<span class="hljs-title function_">join</span>(<span class="hljs-string">&#x27;\n&#x27;</span>))
  }

  params.<span class="hljs-title function_">push</span>(<span class="hljs-string">&#x27;--TMPFILE--&#x27;</span>)
  files.<span class="hljs-title function_">push</span>(leaf)

  openssl.<span class="hljs-title function_">spawnWrapper</span>(params, files, <span class="hljs-keyword">function</span> (<span class="hljs-params">err, code, stdout, stderr</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-12">&#x00a7;</a>
              </div>
              <p>OPENSSL 3.x don’t use stdout to print the error</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-title function_">debug</span>(<span class="hljs-string">&#x27;Vendor&#x27;</span>, openssl.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;Vendor&#x27;</span>))
    <span class="hljs-title function_">debug</span>(<span class="hljs-string">&#x27;VendorVersionMajor&#x27;</span>, openssl.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;VendorVersionMajor&#x27;</span>))
    <span class="hljs-title function_">debug</span>(<span class="hljs-string">&#x27;openssl.get(\&#x27;VendorVersionMajor\&#x27;) &gt;= 3&#x27;</span>, openssl.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;VendorVersionMajor&#x27;</span>) &gt;= <span class="hljs-number">3</span>)

    <span class="hljs-keyword">if</span> (openssl.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;Vendor&#x27;</span>) === <span class="hljs-string">&quot;OPENSSL&quot;</span> &amp;&amp; openssl.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;VendorVersionMajor&#x27;</span>) &gt;= <span class="hljs-number">3</span>) {
      <span class="hljs-keyword">let</span> openssl30Check = !!(stdout &amp;&amp; stdout.<span class="hljs-title function_">trim</span>().<span class="hljs-title function_">includes</span>(<span class="hljs-string">&quot;: OK&quot;</span>));

      <span class="hljs-keyword">if</span> (err) {
        <span class="hljs-title function_">debug</span>(<span class="hljs-string">&#x27;verifySigningChain error&#x27;</span>, {
          <span class="hljs-attr">err</span>: err,
          <span class="hljs-attr">code</span>: code,
          <span class="hljs-attr">stdout</span>: stdout,
          <span class="hljs-attr">stdoutResult</span>: openssl30Check,
          <span class="hljs-attr">stderr</span>: stderr
        })
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">callback</span>(err)
      }

      <span class="hljs-title function_">debug</span>(<span class="hljs-string">&#x27;verifySigningChain error - use stderr&#x27;</span>, {
        <span class="hljs-attr">err</span>: err,
        <span class="hljs-attr">code</span>: code,
        <span class="hljs-attr">stdout</span>: stdout.<span class="hljs-title function_">trim</span>(),
        <span class="hljs-attr">stdoutResult</span>: openssl30Check,
        <span class="hljs-attr">stderr</span>: stderr.<span class="hljs-title function_">trim</span>()
      })
      <span class="hljs-keyword">return</span> <span class="hljs-title function_">callback</span>(<span class="hljs-literal">null</span>, openssl30Check)
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-13">&#x00a7;</a>
              </div>
              <p>END: OPENSSL 3.x don’t use stdout to print the error</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (err) {
      <span class="hljs-title function_">debug</span>(<span class="hljs-string">&#x27;verifySigningChain error&#x27;</span>, {
        <span class="hljs-attr">err</span>: err,
        <span class="hljs-attr">code</span>: code,
        <span class="hljs-attr">stdout</span>: stdout,
        <span class="hljs-attr">stdoutResult</span>: stdout &amp;&amp; stdout.<span class="hljs-title function_">trim</span>().<span class="hljs-title function_">slice</span>(-<span class="hljs-number">4</span>) === <span class="hljs-string">&#x27;: OK&#x27;</span>,
        <span class="hljs-attr">stderr</span>: stderr
      })
      <span class="hljs-keyword">return</span> <span class="hljs-title function_">callback</span>(err)
    }
    <span class="hljs-title function_">debug</span>(<span class="hljs-string">&#x27;verifySigningChain&#x27;</span>, {
      <span class="hljs-attr">err</span>: err,
      <span class="hljs-attr">code</span>: code,
      <span class="hljs-attr">stdout</span>: stdout,
      <span class="hljs-attr">stdoutResult</span>: stdout &amp;&amp; stdout.<span class="hljs-title function_">trim</span>().<span class="hljs-title function_">slice</span>(-<span class="hljs-number">4</span>) === <span class="hljs-string">&#x27;: OK&#x27;</span>,
      <span class="hljs-attr">stderr</span>: stderr
    })
    <span class="hljs-title function_">callback</span>(<span class="hljs-literal">null</span>, stdout &amp;&amp; stdout.<span class="hljs-title function_">trim</span>().<span class="hljs-title function_">slice</span>(-<span class="hljs-number">4</span>) === <span class="hljs-string">&#x27;: OK&#x27;</span>)
  })
}</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-14">&#x00a7;</a>
              </div>
              <p>HELPER FUNCTIONS</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">function</span> <span class="hljs-title function_">fetchCertificateData</span>(<span class="hljs-params">certData, callback</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-15">&#x00a7;</a>
              </div>
              <p>try catch : if something will fail in parsing it won’t crash the calling code</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">try</span> {
    certData = (certData || <span class="hljs-string">&#x27;&#x27;</span>).<span class="hljs-title function_">toString</span>()

    <span class="hljs-keyword">var</span> serial, subject, tmp, issuer
    <span class="hljs-keyword">var</span> certValues = {
      <span class="hljs-attr">issuer</span>: {}
    }
    <span class="hljs-keyword">var</span> validity = {}
    <span class="hljs-keyword">var</span> san

    <span class="hljs-keyword">var</span> ky, i</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-16">&#x00a7;</a>
              </div>
              <p>serial</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> ((serial = certData.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/\s*Serial Number:\r?\n?\s*([^\r\n]*)\r?\n\s*\b/</span>)) &amp;&amp; serial.<span class="hljs-property">length</span> &gt; <span class="hljs-number">1</span>) {
      certValues.<span class="hljs-property">serial</span> = serial[<span class="hljs-number">1</span>]
    }

    <span class="hljs-keyword">if</span> ((subject = certData.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/\s*Subject:\r?\n(\s*(([a-zA-Z0-9.]+)\s=\s[^\r\n]+\r?\n))*\s*\b/</span>)) &amp;&amp; subject.<span class="hljs-property">length</span> &gt; <span class="hljs-number">1</span>) {
      subject = subject[<span class="hljs-number">0</span>]
      tmp = <span class="hljs-title function_">matchAll</span>(subject, <span class="hljs-regexp">/\s([a-zA-Z0-9.]+)\s=\s([^\r\n].*)/g</span>)
      <span class="hljs-keyword">if</span> (tmp) {
        <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; tmp.<span class="hljs-property">length</span>; i++) {
          ky = tmp[i][<span class="hljs-number">1</span>].<span class="hljs-title function_">trim</span>()
          <span class="hljs-keyword">if</span> (ky.<span class="hljs-title function_">match</span>(<span class="hljs-string">&#x27;(C|ST|L|O|OU|CN|emailAddress|DC)&#x27;</span>) || ky === <span class="hljs-string">&#x27;&#x27;</span>) {
            <span class="hljs-keyword">continue</span>
          }
          certValues[ky] = tmp[i][<span class="hljs-number">2</span>].<span class="hljs-title function_">trim</span>()
        }
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-17">&#x00a7;</a>
              </div>
              <p>country</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      tmp = subject.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/\sC\s=\s([^\r\n].*?)[\r\n]/</span>)
      certValues.<span class="hljs-property">country</span> = (tmp &amp;&amp; tmp[<span class="hljs-number">1</span>]) || <span class="hljs-string">&#x27;&#x27;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-18">&#x00a7;</a>
              </div>
              <p>state</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      tmp = subject.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/\sST\s=\s([^\r\n].*?)[\r\n]/</span>)
      certValues.<span class="hljs-property">state</span> = (tmp &amp;&amp; tmp[<span class="hljs-number">1</span>]) || <span class="hljs-string">&#x27;&#x27;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-19">&#x00a7;</a>
              </div>
              <p>locality</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      tmp = subject.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/\sL\s=\s([^\r\n].*?)[\r\n]/</span>)
      certValues.<span class="hljs-property">locality</span> = (tmp &amp;&amp; tmp[<span class="hljs-number">1</span>]) || <span class="hljs-string">&#x27;&#x27;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-20">&#x00a7;</a>
              </div>
              <p>organization</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      tmp = <span class="hljs-title function_">matchAll</span>(subject, <span class="hljs-regexp">/\sO\s=\s([^\r\n].*)/g</span>)
      certValues.<span class="hljs-property">organization</span> = tmp ? (tmp.<span class="hljs-property">length</span> &gt; <span class="hljs-number">1</span> ? tmp.<span class="hljs-title function_">sort</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">t, n</span>) {
        <span class="hljs-keyword">var</span> e = t[<span class="hljs-number">1</span>].<span class="hljs-title function_">toUpperCase</span>()
        <span class="hljs-keyword">var</span> r = n[<span class="hljs-number">1</span>].<span class="hljs-title function_">toUpperCase</span>()
        <span class="hljs-keyword">return</span> r &gt; e ? -<span class="hljs-number">1</span> : e &gt; r ? <span class="hljs-number">1</span> : <span class="hljs-number">0</span>
      }).<span class="hljs-title function_">sort</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">t, n</span>) {
        <span class="hljs-keyword">return</span> t[<span class="hljs-number">1</span>].<span class="hljs-property">length</span> - n[<span class="hljs-number">1</span>].<span class="hljs-property">length</span>
      }).<span class="hljs-title function_">map</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">t</span>) {
        <span class="hljs-keyword">return</span> t[<span class="hljs-number">1</span>]
      }) : tmp[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>]) : <span class="hljs-string">&#x27;&#x27;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-21">&#x00a7;</a>
              </div>
              <p>unit</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      tmp = <span class="hljs-title function_">matchAll</span>(subject, <span class="hljs-regexp">/\sOU\s=\s([^\r\n].*)/g</span>)
      certValues.<span class="hljs-property">organizationUnit</span> = tmp ? (tmp.<span class="hljs-property">length</span> &gt; <span class="hljs-number">1</span> ? tmp.<span class="hljs-title function_">sort</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">t, n</span>) {
        <span class="hljs-keyword">var</span> e = t[<span class="hljs-number">1</span>].<span class="hljs-title function_">toUpperCase</span>()
        <span class="hljs-keyword">var</span> r = n[<span class="hljs-number">1</span>].<span class="hljs-title function_">toUpperCase</span>()
        <span class="hljs-keyword">return</span> r &gt; e ? -<span class="hljs-number">1</span> : e &gt; r ? <span class="hljs-number">1</span> : <span class="hljs-number">0</span>
      }).<span class="hljs-title function_">sort</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">t, n</span>) {
        <span class="hljs-keyword">return</span> t[<span class="hljs-number">1</span>].<span class="hljs-property">length</span> - n[<span class="hljs-number">1</span>].<span class="hljs-property">length</span>
      }).<span class="hljs-title function_">map</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">t</span>) {
        <span class="hljs-keyword">return</span> t[<span class="hljs-number">1</span>]
      }) : tmp[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>]) : <span class="hljs-string">&#x27;&#x27;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-22">&#x00a7;</a>
              </div>
              <p>common name</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      tmp = <span class="hljs-title function_">matchAll</span>(subject, <span class="hljs-regexp">/\sCN\s=\s([^\r\n].*)/g</span>)
      certValues.<span class="hljs-property">commonName</span> = tmp ? (tmp.<span class="hljs-property">length</span> &gt; <span class="hljs-number">1</span> ? tmp.<span class="hljs-title function_">sort</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">t, n</span>) {
        <span class="hljs-keyword">var</span> e = t[<span class="hljs-number">1</span>].<span class="hljs-title function_">toUpperCase</span>()
        <span class="hljs-keyword">var</span> r = n[<span class="hljs-number">1</span>].<span class="hljs-title function_">toUpperCase</span>()
        <span class="hljs-keyword">return</span> r &gt; e ? -<span class="hljs-number">1</span> : e &gt; r ? <span class="hljs-number">1</span> : <span class="hljs-number">0</span>
      }).<span class="hljs-title function_">sort</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">t, n</span>) {
        <span class="hljs-keyword">return</span> t[<span class="hljs-number">1</span>].<span class="hljs-property">length</span> - n[<span class="hljs-number">1</span>].<span class="hljs-property">length</span>
      }).<span class="hljs-title function_">map</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">t</span>) {
        <span class="hljs-keyword">return</span> t[<span class="hljs-number">1</span>]
      }) : tmp[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>]) : <span class="hljs-string">&#x27;&#x27;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-23">&#x00a7;</a>
              </div>
              <p>email</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      tmp = <span class="hljs-title function_">matchAll</span>(subject, <span class="hljs-regexp">/emailAddress\s=\s([^\r\n].*)/g</span>)
      certValues.<span class="hljs-property">emailAddress</span> = tmp ? (tmp.<span class="hljs-property">length</span> &gt; <span class="hljs-number">1</span> ? tmp.<span class="hljs-title function_">sort</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">t, n</span>) {
        <span class="hljs-keyword">var</span> e = t[<span class="hljs-number">1</span>].<span class="hljs-title function_">toUpperCase</span>()
        <span class="hljs-keyword">var</span> r = n[<span class="hljs-number">1</span>].<span class="hljs-title function_">toUpperCase</span>()
        <span class="hljs-keyword">return</span> r &gt; e ? -<span class="hljs-number">1</span> : e &gt; r ? <span class="hljs-number">1</span> : <span class="hljs-number">0</span>
      }).<span class="hljs-title function_">sort</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">t, n</span>) {
        <span class="hljs-keyword">return</span> t[<span class="hljs-number">1</span>].<span class="hljs-property">length</span> - n[<span class="hljs-number">1</span>].<span class="hljs-property">length</span>
      }).<span class="hljs-title function_">map</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">t</span>) {
        <span class="hljs-keyword">return</span> t[<span class="hljs-number">1</span>]
      }) : tmp[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>]) : <span class="hljs-string">&#x27;&#x27;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-24">&#x00a7;</a>
              </div>
              <p>DC name</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      tmp = <span class="hljs-title function_">matchAll</span>(subject, <span class="hljs-regexp">/\sDC\s=\s([^\r\n].*)/g</span>)
      certValues.<span class="hljs-property">dc</span> = tmp ? (tmp.<span class="hljs-property">length</span> &gt; <span class="hljs-number">1</span> ? tmp.<span class="hljs-title function_">sort</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">t, n</span>) {
        <span class="hljs-keyword">var</span> e = t[<span class="hljs-number">1</span>].<span class="hljs-title function_">toUpperCase</span>()
        <span class="hljs-keyword">var</span> r = n[<span class="hljs-number">1</span>].<span class="hljs-title function_">toUpperCase</span>()
        <span class="hljs-keyword">return</span> r &gt; e ? -<span class="hljs-number">1</span> : e &gt; r ? <span class="hljs-number">1</span> : <span class="hljs-number">0</span>
      }).<span class="hljs-title function_">sort</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">t, n</span>) {
        <span class="hljs-keyword">return</span> t[<span class="hljs-number">1</span>].<span class="hljs-property">length</span> - n[<span class="hljs-number">1</span>].<span class="hljs-property">length</span>
      }).<span class="hljs-title function_">map</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">t</span>) {
        <span class="hljs-keyword">return</span> t[<span class="hljs-number">1</span>]
      }) : tmp[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>]) : <span class="hljs-string">&#x27;&#x27;</span>
    }

    <span class="hljs-keyword">if</span> ((issuer = certData.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/\s*Issuer:\r?\n(\s*([a-zA-Z0-9.]+)\s=\s[^\r\n].*\r?\n)*\s*\b/</span>)) &amp;&amp; issuer.<span class="hljs-property">length</span> &gt; <span class="hljs-number">1</span>) {
      issuer = issuer[<span class="hljs-number">0</span>]
      tmp = <span class="hljs-title function_">matchAll</span>(issuer, <span class="hljs-regexp">/\s([a-zA-Z0-9.]+)\s=\s([^\r\n].*)/g</span>)
      <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; tmp.<span class="hljs-property">length</span>; i++) {
        ky = tmp[i][<span class="hljs-number">1</span>].<span class="hljs-title function_">toString</span>()
        <span class="hljs-keyword">if</span> (ky.<span class="hljs-title function_">match</span>(<span class="hljs-string">&#x27;(C|ST|L|O|OU|CN|emailAddress|DC)&#x27;</span>)) {
          <span class="hljs-keyword">continue</span>
        }
        certValues.<span class="hljs-property">issuer</span>[ky] = tmp[i][<span class="hljs-number">2</span>].<span class="hljs-title function_">toString</span>()
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-25">&#x00a7;</a>
              </div>
              <p>country</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      tmp = issuer.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/\sC\s=\s([^\r\n].*?)[\r\n]/</span>)
      certValues.<span class="hljs-property">issuer</span>.<span class="hljs-property">country</span> = (tmp &amp;&amp; tmp[<span class="hljs-number">1</span>]) || <span class="hljs-string">&#x27;&#x27;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-26">&#x00a7;</a>
              </div>
              <p>state</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      tmp = issuer.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/\sST\s=\s([^\r\n].*?)[\r\n]/</span>)
      certValues.<span class="hljs-property">issuer</span>.<span class="hljs-property">state</span> = (tmp &amp;&amp; tmp[<span class="hljs-number">1</span>]) || <span class="hljs-string">&#x27;&#x27;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-27">&#x00a7;</a>
              </div>
              <p>locality</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      tmp = issuer.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/\sL\s=\s([^\r\n].*?)[\r\n]/</span>)
      certValues.<span class="hljs-property">issuer</span>.<span class="hljs-property">locality</span> = (tmp &amp;&amp; tmp[<span class="hljs-number">1</span>]) || <span class="hljs-string">&#x27;&#x27;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-28">&#x00a7;</a>
              </div>
              <p>organization</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      tmp = <span class="hljs-title function_">matchAll</span>(issuer, <span class="hljs-regexp">/\sO\s=\s([^\r\n].*)/g</span>)
      certValues.<span class="hljs-property">issuer</span>.<span class="hljs-property">organization</span> = tmp ? (tmp.<span class="hljs-property">length</span> &gt; <span class="hljs-number">1</span> ? tmp.<span class="hljs-title function_">sort</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">t, n</span>) {
        <span class="hljs-keyword">var</span> e = t[<span class="hljs-number">1</span>].<span class="hljs-title function_">toUpperCase</span>()
        <span class="hljs-keyword">var</span> r = n[<span class="hljs-number">1</span>].<span class="hljs-title function_">toUpperCase</span>()
        <span class="hljs-keyword">return</span> r &gt; e ? -<span class="hljs-number">1</span> : e &gt; r ? <span class="hljs-number">1</span> : <span class="hljs-number">0</span>
      }).<span class="hljs-title function_">sort</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">t, n</span>) {
        <span class="hljs-keyword">return</span> t[<span class="hljs-number">1</span>].<span class="hljs-property">length</span> - n[<span class="hljs-number">1</span>].<span class="hljs-property">length</span>
      }).<span class="hljs-title function_">map</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">t</span>) {
        <span class="hljs-keyword">return</span> t[<span class="hljs-number">1</span>]
      }) : tmp[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>]) : <span class="hljs-string">&#x27;&#x27;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-29">&#x00a7;</a>
              </div>
              <p>unit</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      tmp = <span class="hljs-title function_">matchAll</span>(issuer, <span class="hljs-regexp">/\sOU\s=\s([^\r\n].*)/g</span>)
      certValues.<span class="hljs-property">issuer</span>.<span class="hljs-property">organizationUnit</span> = tmp ? (tmp.<span class="hljs-property">length</span> &gt; <span class="hljs-number">1</span> ? tmp.<span class="hljs-title function_">sort</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">t, n</span>) {
        <span class="hljs-keyword">var</span> e = t[<span class="hljs-number">1</span>].<span class="hljs-title function_">toUpperCase</span>()
        <span class="hljs-keyword">var</span>
          r = n[<span class="hljs-number">1</span>].<span class="hljs-title function_">toUpperCase</span>()
        <span class="hljs-keyword">return</span> r &gt; e ? -<span class="hljs-number">1</span> : e &gt; r ? <span class="hljs-number">1</span> : <span class="hljs-number">0</span>
      }).<span class="hljs-title function_">sort</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">t, n</span>) {
        <span class="hljs-keyword">return</span> t[<span class="hljs-number">1</span>].<span class="hljs-property">length</span> - n[<span class="hljs-number">1</span>].<span class="hljs-property">length</span>
      }).<span class="hljs-title function_">map</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">t</span>) {
        <span class="hljs-keyword">return</span> t[<span class="hljs-number">1</span>]
      }) : tmp[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>]) : <span class="hljs-string">&#x27;&#x27;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-30">&#x00a7;</a>
              </div>
              <p>common name</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      tmp = <span class="hljs-title function_">matchAll</span>(issuer, <span class="hljs-regexp">/\sCN\s=\s([^\r\n].*)/g</span>)
      certValues.<span class="hljs-property">issuer</span>.<span class="hljs-property">commonName</span> = tmp ? (tmp.<span class="hljs-property">length</span> &gt; <span class="hljs-number">1</span> ? tmp.<span class="hljs-title function_">sort</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">t, n</span>) {
        <span class="hljs-keyword">var</span> e = t[<span class="hljs-number">1</span>].<span class="hljs-title function_">toUpperCase</span>()
        <span class="hljs-keyword">var</span>
          r = n[<span class="hljs-number">1</span>].<span class="hljs-title function_">toUpperCase</span>()
        <span class="hljs-keyword">return</span> r &gt; e ? -<span class="hljs-number">1</span> : e &gt; r ? <span class="hljs-number">1</span> : <span class="hljs-number">0</span>
      }).<span class="hljs-title function_">sort</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">t, n</span>) {
        <span class="hljs-keyword">return</span> t[<span class="hljs-number">1</span>].<span class="hljs-property">length</span> - n[<span class="hljs-number">1</span>].<span class="hljs-property">length</span>
      }).<span class="hljs-title function_">map</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">t</span>) {
        <span class="hljs-keyword">return</span> t[<span class="hljs-number">1</span>]
      }) : tmp[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>]) : <span class="hljs-string">&#x27;&#x27;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-31">&#x00a7;</a>
              </div>
              <p>DC name</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      tmp = <span class="hljs-title function_">matchAll</span>(issuer, <span class="hljs-regexp">/\sDC\s=\s([^\r\n].*)/g</span>)
      certValues.<span class="hljs-property">issuer</span>.<span class="hljs-property">dc</span> = tmp ? (tmp.<span class="hljs-property">length</span> &gt; <span class="hljs-number">1</span> ? tmp.<span class="hljs-title function_">sort</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">t, n</span>) {
        <span class="hljs-keyword">var</span> e = t[<span class="hljs-number">1</span>].<span class="hljs-title function_">toUpperCase</span>()
        <span class="hljs-keyword">var</span>
          r = n[<span class="hljs-number">1</span>].<span class="hljs-title function_">toUpperCase</span>()
        <span class="hljs-keyword">return</span> r &gt; e ? -<span class="hljs-number">1</span> : e &gt; r ? <span class="hljs-number">1</span> : <span class="hljs-number">0</span>
      }).<span class="hljs-title function_">sort</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">t, n</span>) {
        <span class="hljs-keyword">return</span> t[<span class="hljs-number">1</span>].<span class="hljs-property">length</span> - n[<span class="hljs-number">1</span>].<span class="hljs-property">length</span>
      }).<span class="hljs-title function_">map</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">t</span>) {
        <span class="hljs-keyword">return</span> t[<span class="hljs-number">1</span>]
      }) : tmp[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>]) : <span class="hljs-string">&#x27;&#x27;</span>
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-32">&#x00a7;</a>
              </div>
              <p>SAN</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> ((san = certData.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/X509v3 Subject Alternative Name: \r?\n([^\r\n]*)\r?\n/</span>)) &amp;&amp; san.<span class="hljs-property">length</span> &gt; <span class="hljs-number">1</span>) {
      san = san[<span class="hljs-number">1</span>].<span class="hljs-title function_">trim</span>() + <span class="hljs-string">&#x27;\n&#x27;</span>
      certValues.<span class="hljs-property">san</span> = {}</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-33">&#x00a7;</a>
              </div>
              <p>hostnames</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      tmp = <span class="hljs-title function_">pregMatchAll</span>(<span class="hljs-string">&#x27;DNS:([^,\\r\\n].*?)[,\\r\\n\\s]&#x27;</span>, san)
      certValues.<span class="hljs-property">san</span>.<span class="hljs-property">dns</span> = tmp || <span class="hljs-string">&#x27;&#x27;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-34">&#x00a7;</a>
              </div>
              <p>IP-Addresses IPv4 &amp; IPv6</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      tmp = <span class="hljs-title function_">pregMatchAll</span>(<span class="hljs-string">&#x27;IP Address:([^,\\r\\n].*?)[,\\r\\n\\s]&#x27;</span>, san)
      certValues.<span class="hljs-property">san</span>.<span class="hljs-property">ip</span> = tmp || <span class="hljs-string">&#x27;&#x27;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-35">&#x00a7;</a>
              </div>
              <p>Email Addresses</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      tmp = <span class="hljs-title function_">pregMatchAll</span>(<span class="hljs-string">&#x27;email:([^,\\r\\n].*?)[,\\r\\n\\s]&#x27;</span>, san)
      certValues.<span class="hljs-property">san</span>.<span class="hljs-property">email</span> = tmp || <span class="hljs-string">&#x27;&#x27;</span>
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-36">&#x00a7;</a>
              </div>
              <p>Validity</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> ((tmp = certData.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/Not Before\s?:\s?([^\r\n]*)\r?\n/</span>)) &amp;&amp; tmp.<span class="hljs-property">length</span> &gt; <span class="hljs-number">1</span>) {
      validity.<span class="hljs-property">start</span> = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">parse</span>((tmp &amp;&amp; tmp[<span class="hljs-number">1</span>]) || <span class="hljs-string">&#x27;&#x27;</span>)
    }

    <span class="hljs-keyword">if</span> ((tmp = certData.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/Not After\s?:\s?([^\r\n]*)\r?\n/</span>)) &amp;&amp; tmp.<span class="hljs-property">length</span> &gt; <span class="hljs-number">1</span>) {
      validity.<span class="hljs-property">end</span> = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">parse</span>((tmp &amp;&amp; tmp[<span class="hljs-number">1</span>]) || <span class="hljs-string">&#x27;&#x27;</span>)
    }

    <span class="hljs-keyword">if</span> (validity.<span class="hljs-property">start</span> &amp;&amp; validity.<span class="hljs-property">end</span>) {
      certValues.<span class="hljs-property">validity</span> = validity
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-37">&#x00a7;</a>
              </div>
              <p>Validity end</p>

            </div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-38">&#x00a7;</a>
              </div>
              <p>Signature Algorithm</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> ((tmp = certData.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/Signature Algorithm: ([^\r\n]*)\r?\n/</span>)) &amp;&amp; tmp.<span class="hljs-property">length</span> &gt; <span class="hljs-number">1</span>) {
      certValues.<span class="hljs-property">signatureAlgorithm</span> = (tmp &amp;&amp; tmp[<span class="hljs-number">1</span>]) || <span class="hljs-string">&#x27;&#x27;</span>
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-39">&#x00a7;</a>
              </div>
              <p>Public Key</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> ((tmp = certData.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/Public[ -]Key: ([^\r\n]*)\r?\n/</span>)) &amp;&amp; tmp.<span class="hljs-property">length</span> &gt; <span class="hljs-number">1</span>) {
      certValues.<span class="hljs-property">publicKeySize</span> = ((tmp &amp;&amp; tmp[<span class="hljs-number">1</span>]) || <span class="hljs-string">&#x27;&#x27;</span>).<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/[()]/g</span>, <span class="hljs-string">&#x27;&#x27;</span>)
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-40">&#x00a7;</a>
              </div>
              <p>Public Key Algorithm</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> ((tmp = certData.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/Public Key Algorithm: ([^\r\n]*)\r?\n/</span>)) &amp;&amp; tmp.<span class="hljs-property">length</span> &gt; <span class="hljs-number">1</span>) {
      certValues.<span class="hljs-property">publicKeyAlgorithm</span> = (tmp &amp;&amp; tmp[<span class="hljs-number">1</span>]) || <span class="hljs-string">&#x27;&#x27;</span>
    }

    <span class="hljs-title function_">callback</span>(<span class="hljs-literal">null</span>, certValues)
  } <span class="hljs-keyword">catch</span> (err) {
    <span class="hljs-title function_">callback</span>(err)
  }
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">matchAll</span>(<span class="hljs-params">str, regexp</span>) {
  <span class="hljs-keyword">var</span> matches = []
  str.<span class="hljs-title function_">replace</span>(regexp, <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {
    <span class="hljs-keyword">var</span> arr = ([]).<span class="hljs-property">slice</span>.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">arguments</span>, <span class="hljs-number">0</span>)
    <span class="hljs-keyword">var</span> extras = arr.<span class="hljs-title function_">splice</span>(-<span class="hljs-number">2</span>)
    arr.<span class="hljs-property">index</span> = extras[<span class="hljs-number">0</span>]
    arr.<span class="hljs-property">input</span> = extras[<span class="hljs-number">1</span>]
    matches.<span class="hljs-title function_">push</span>(arr)
  })
  <span class="hljs-keyword">return</span> matches.<span class="hljs-property">length</span> ? matches : <span class="hljs-literal">null</span>
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">pregMatchAll</span>(<span class="hljs-params">regex, haystack</span>) {
  <span class="hljs-keyword">var</span> globalRegex = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RegExp</span>(regex, <span class="hljs-string">&#x27;g&#x27;</span>)
  <span class="hljs-keyword">var</span> globalMatch = haystack.<span class="hljs-title function_">match</span>(globalRegex) || []
  <span class="hljs-keyword">var</span> matchArray = []
  <span class="hljs-keyword">var</span> nonGlobalRegex, nonGlobalMatch
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; globalMatch.<span class="hljs-property">length</span>; i++) {
    nonGlobalRegex = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RegExp</span>(regex)
    nonGlobalMatch = globalMatch[i].<span class="hljs-title function_">match</span>(nonGlobalRegex)
    matchArray.<span class="hljs-title function_">push</span>(nonGlobalMatch[<span class="hljs-number">1</span>])
  }
  <span class="hljs-keyword">return</span> matchArray
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">generateCSRSubject</span>(<span class="hljs-params">options</span>) {
  options = options || {}

  <span class="hljs-keyword">var</span> csrData = {
    <span class="hljs-attr">C</span>: options.<span class="hljs-property">country</span> || options.<span class="hljs-property">C</span>,
    <span class="hljs-attr">ST</span>: options.<span class="hljs-property">state</span> || options.<span class="hljs-property">ST</span>,
    <span class="hljs-attr">L</span>: options.<span class="hljs-property">locality</span> || options.<span class="hljs-property">L</span>,
    <span class="hljs-attr">O</span>: options.<span class="hljs-property">organization</span> || options.<span class="hljs-property">O</span>,
    <span class="hljs-attr">OU</span>: options.<span class="hljs-property">organizationUnit</span> || options.<span class="hljs-property">OU</span>,
    <span class="hljs-attr">CN</span>: options.<span class="hljs-property">commonName</span> || options.<span class="hljs-property">CN</span> || <span class="hljs-string">&#x27;localhost&#x27;</span>,
    <span class="hljs-attr">DC</span>: options.<span class="hljs-property">dc</span> || options.<span class="hljs-property">DC</span> || <span class="hljs-string">&#x27;&#x27;</span>,
    <span class="hljs-attr">emailAddress</span>: options.<span class="hljs-property">emailAddress</span>
  }

  <span class="hljs-keyword">var</span> csrBuilder = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(csrData).<span class="hljs-title function_">map</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">key</span>) {
    <span class="hljs-keyword">if</span> (csrData[key]) {
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> csrData[key] === <span class="hljs-string">&#x27;object&#x27;</span> &amp;&amp; csrData[key].<span class="hljs-property">length</span> &gt;= <span class="hljs-number">1</span>) {
        <span class="hljs-keyword">var</span> tmpStr = <span class="hljs-string">&#x27;&#x27;</span>
        csrData[key].<span class="hljs-title function_">map</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">o</span>) {
          tmpStr += <span class="hljs-string">&#x27;/&#x27;</span> + key + <span class="hljs-string">&#x27;=&#x27;</span> + o.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/[^\w\s-!$%^&amp;*()_+|~=`{}[\]:/;&lt;&gt;?,.@#]+/g</span>, <span class="hljs-string">&#x27; &#x27;</span>).<span class="hljs-title function_">replace</span>(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-string">&#x27;\\/&#x27;</span>).<span class="hljs-title function_">replace</span>(<span class="hljs-string">&#x27;+&#x27;</span>, <span class="hljs-string">&#x27;\\+&#x27;</span>).<span class="hljs-title function_">trim</span>()
        })
        <span class="hljs-keyword">return</span> tmpStr
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;/&#x27;</span> + key + <span class="hljs-string">&#x27;=&#x27;</span> + csrData[key].<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/[^\w\s-!$%^&amp;*()_+|~=`{}[\]:/;&lt;&gt;?,.@#]+/g</span>, <span class="hljs-string">&#x27; &#x27;</span>).<span class="hljs-title function_">replace</span>(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-string">&#x27;\\/&#x27;</span>).<span class="hljs-title function_">replace</span>(<span class="hljs-string">&#x27;+&#x27;</span>, <span class="hljs-string">&#x27;\\+&#x27;</span>).<span class="hljs-title function_">trim</span>()
      }
    }
  })

  <span class="hljs-keyword">return</span> csrBuilder.<span class="hljs-title function_">join</span>(<span class="hljs-string">&#x27;&#x27;</span>)
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">readFromString</span>(<span class="hljs-params">string, start, end</span>) {
  <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Buffer</span>.<span class="hljs-title function_">isBuffer</span>(string)) {
    string = string.<span class="hljs-title function_">toString</span>(<span class="hljs-string">&#x27;utf8&#x27;</span>)
  }

  <span class="hljs-keyword">var</span> output = []

  <span class="hljs-keyword">if</span> (!string) {
    <span class="hljs-keyword">return</span> output
  }

  <span class="hljs-keyword">var</span> offset = string.<span class="hljs-title function_">indexOf</span>(start)

  <span class="hljs-keyword">while</span> (offset !== -<span class="hljs-number">1</span>) {
    string = string.<span class="hljs-title function_">substring</span>(offset)

    <span class="hljs-keyword">var</span> endOffset = string.<span class="hljs-title function_">indexOf</span>(end)

    <span class="hljs-keyword">if</span> (endOffset === -<span class="hljs-number">1</span>) {
      <span class="hljs-keyword">break</span>
    }

    endOffset += end.<span class="hljs-property">length</span>

    output.<span class="hljs-title function_">push</span>(string.<span class="hljs-title function_">substring</span>(<span class="hljs-number">0</span>, endOffset))
    offset = string.<span class="hljs-title function_">indexOf</span>(start, endOffset)
  }

  <span class="hljs-keyword">return</span> output
}</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-41">&#x00a7;</a>
              </div>
              <p>promisify not tested yet</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/**
 * Verifies the signing chain of the passed certificate
 * <span class="hljs-doctag">@namespace</span>
 * <span class="hljs-doctag">@name</span> <span class="hljs-variable">promisified</span>
 * <span class="hljs-doctag">@property</span> {<span class="hljs-type">function</span>}  createPrivateKey               <span class="hljs-doctag">@see</span> <span class="hljs-variable">createPrivateKey</span>
 * <span class="hljs-doctag">@property</span> {<span class="hljs-type">function</span>}  <span class="hljs-variable">createDhparam</span>       - The default number of players.
 * <span class="hljs-doctag">@property</span> {<span class="hljs-type">function</span>}  <span class="hljs-variable">createEcparam</span>         - The default level for the party.
 * <span class="hljs-doctag">@property</span> {<span class="hljs-type">function</span>}  <span class="hljs-variable">createCSR</span>      - The default treasure.
 * <span class="hljs-doctag">@property</span> {<span class="hljs-type">function</span>}  <span class="hljs-variable">createCertificate</span> - How much gold the party starts with.
 */</span>
<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span>.<span class="hljs-property">promisified</span> = {
  <span class="hljs-attr">createPrivateKey</span>: <span class="hljs-title function_">promisify</span>(createPrivateKey),
  <span class="hljs-attr">createDhparam</span>: <span class="hljs-title function_">promisify</span>(createDhparam),
  <span class="hljs-attr">createEcparam</span>: <span class="hljs-title function_">promisify</span>(createEcparam),
  <span class="hljs-attr">createCSR</span>: <span class="hljs-title function_">promisify</span>(createCSR),
  <span class="hljs-attr">createCertificate</span>: <span class="hljs-title function_">promisify</span>(createCertificate),
  <span class="hljs-attr">readCertificateInfo</span>: <span class="hljs-title function_">promisify</span>(readCertificateInfo),
  <span class="hljs-attr">getPublicKey</span>: <span class="hljs-title function_">promisify</span>(getPublicKey),
  <span class="hljs-attr">getFingerprint</span>: <span class="hljs-title function_">promisify</span>(getFingerprint),
  <span class="hljs-attr">getModulus</span>: <span class="hljs-title function_">promisify</span>(getModulus),
  <span class="hljs-attr">getDhparamInfo</span>: <span class="hljs-title function_">promisify</span>(getDhparamInfo),
  <span class="hljs-attr">createPkcs12</span>: <span class="hljs-title function_">promisify</span>(createPkcs12),
  <span class="hljs-attr">readPkcs12</span>: <span class="hljs-title function_">promisify</span>(readPkcs12),
  <span class="hljs-attr">verifySigningChain</span>: <span class="hljs-title function_">promisify</span>(verifySigningChain),
  <span class="hljs-attr">checkCertificate</span>: <span class="hljs-title function_">promisify</span>(checkCertificate),
  <span class="hljs-attr">checkPkcs12</span>: <span class="hljs-title function_">promisify</span>(checkPkcs12)
}</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
