require('./sourcemap-register.js');(()=>{var e={143:(e,r,t)=>{const{isexe:n,sync:s}=t(200);const{join:i,delimiter:o,sep:a,posix:c}=t(17);const u=process.platform==="win32";const f=new RegExp(`[${c.sep}${a===c.sep?"":a}]`.replace(/(\\)/g,"\\$1"));const p=new RegExp(`^\\.${f.source}`);const getNotFoundError=e=>Object.assign(new Error(`not found: ${e}`),{code:"ENOENT"});const getPathInfo=(e,{path:r=process.env.PATH,pathExt:t=process.env.PATHEXT,delimiter:n=o})=>{const s=e.match(f)?[""]:[...u?[process.cwd()]:[],...(r||"").split(n)];if(u){const r=t||[".EXE",".CMD",".BAT",".COM"].join(n);const i=r.split(n).flatMap((e=>[e,e.toLowerCase()]));if(e.includes(".")&&i[0]!==""){i.unshift("")}return{pathEnv:s,pathExt:i,pathExtExe:r}}return{pathEnv:s,pathExt:[""]}};const getPathPart=(e,r)=>{const t=/^".*"$/.test(e)?e.slice(1,-1):e;const n=!t&&p.test(r)?r.slice(0,2):"";return n+i(t,r)};const which=async(e,r={})=>{const{pathEnv:t,pathExt:s,pathExtExe:i}=getPathInfo(e,r);const o=[];for(const a of t){const t=getPathPart(a,e);for(const e of s){const s=t+e;const a=await n(s,{pathExt:i,ignoreErrors:true});if(a){if(!r.all){return s}o.push(s)}}}if(r.all&&o.length){return o}if(r.nothrow){return null}throw getNotFoundError(e)};const whichSync=(e,r={})=>{const{pathEnv:t,pathExt:n,pathExtExe:i}=getPathInfo(e,r);const o=[];for(const a of t){const t=getPathPart(a,e);for(const e of n){const n=t+e;const a=s(n,{pathExt:i,ignoreErrors:true});if(a){if(!r.all){return n}o.push(n)}}}if(r.all&&o.length){return o}if(r.nothrow){return null}throw getNotFoundError(e)};e.exports=which;which.sync=whichSync},81:e=>{"use strict";e.exports=require("child_process")},113:e=>{"use strict";e.exports=require("crypto")},147:e=>{"use strict";e.exports=require("fs")},292:e=>{"use strict";e.exports=require("fs/promises")},808:e=>{"use strict";e.exports=require("net")},5:e=>{"use strict";e.exports=require("node:crypto")},261:e=>{"use strict";e.exports=require("node:util")},37:e=>{"use strict";e.exports=require("os")},17:e=>{"use strict";e.exports=require("path")},254:(e,r,t)=>{"use strict";var n=t(702);var s=t(649);var{debug:i}=t(762);e.exports.PEM2DER=function(e,r,t,s){if(!s&&typeof t==="function"){s=t;t="x509"}var i=[t,"-outform","der","-in",e,"-out",r];n.spawnWrapper(i,false,(function(e,r){if(e){s(e)}else{s(null,r===0)}}))};e.exports.DER2PEM=function(e,r,t,s){if(!s&&typeof t==="function"){s=t;t="x509"}var i=[t,"-inform","der","-in",e,"-out",r];n.spawnWrapper(i,false,(function(e,r){if(e){s(e)}else{s(null,r===0)}}))};e.exports.PEM2P7B=function(e,r,t){var s=["crl2pkcs7","-nocrl","-certfile",e.cert,"-out",r];if(e.ca){if(!Array.isArray(e.ca)){e.ca=[e.ca]}e.ca.forEach((function(e){s.push("-certfile");s.push(e)}))}n.spawnWrapper(s,false,(function(e,r){if(e){t(e)}else{t(null,r===0)}}))};e.exports.P7B2PEM=function(e,r,t){var s=["pkcs7","-print_certs","-in",e,"-out",r];n.spawnWrapper(s,false,(function(e,r){if(e){t(e)}else{t(null,r===0)}}))};e.exports.PEM2PFX=function(e,r,t,i){var o=["pkcs12","-export","-out",r,"-inkey",e.key,"-in",e.cert];if(e.ca){if(!Array.isArray(e.ca)){e.ca=[e.ca]}e.ca.forEach((function(e){o.push("-certfile");o.push(e)}))}var a=[];s.createPasswordFile({cipher:"",password:t,passType:"in"},o,a);s.createPasswordFile({cipher:"",password:t,passType:"out"},o,a);n.spawnWrapper(o,false,(function(e,r){function done(e){if(e){i(e)}else{i(null,r===0)}}s.deleteTempFiles(a,(function(r){done(e||r)}))}))};e.exports.PFX2PEM=function(e,r,t,i){var o=["pkcs12","-in",e,"-out",r,"-nodes"];var a=[];s.createPasswordFile({cipher:"",password:t,passType:"in"},o,a);s.createPasswordFile({cipher:"",password:t,passType:"out"},o,a);n.spawnWrapper(o,false,(function(e,r){function done(e){if(e){i(e)}else{i(null,r===0)}}s.deleteTempFiles(a,(function(r){done(e||r)}))}))};e.exports.P7B2PFX=function(e,r,t,o){var a=e.cert.replace(/\.[^.]+$/,".cer");var c=["pkcs7","-print_certs","-in",e.cert,"-out",a];n.spawnWrapper(c,false,(function(c,u){i("P7B2PFX",{error:c,code:u});if(c){o(c)}else{var f=["pkcs12","-export","-in",a,"-inkey",e.key,"-out",r];if(e.ca){if(!Array.isArray(e.ca)){e.ca=[e.ca]}e.ca.forEach((function(e){f.push("-certfile");f.push(e)}))}var p=[a];s.createPasswordFile({cipher:"",password:t,passType:"in"},f,p);s.createPasswordFile({cipher:"",password:t,passType:"out"},f,p);n.spawnWrapper(f,false,(function(e,r){function done(e){if(e){o(e)}else{o(null,r===0)}}s.deleteTempFiles(p,(function(r){done(e||r)}))}))}}))}},762:e=>{function debug(e,r){if(process.env.DEBUG==="true"){console.log(`::group::${e}`);console.log(JSON.stringify(r,null,3));console.log("::endgroup::")}}e.exports={debug:debug}},649:(e,r,t)=>{"use strict";var n=t(17);var s=t(147);var i=t(113);const{tmpdir:o}=t(37);var a=process.env.PEMJS_TMPDIR||o();e.exports.isNumber=function(e){if(Array.isArray(e)){return false}return/^\d+$/g.test(e)};e.exports.isHex=function isHex(e){return/^(0x){0,1}([0-9A-F]{1,40}|[0-9A-F]{1,40})$/gi.test(e)};e.exports.toHex=function toHex(e){var r="";for(var t=0;t<e.length;t++){r+=""+e.charCodeAt(t).toString(16)}return r};e.exports.ciphers=["aes128","aes192","aes256","camellia128","camellia192","camellia256","des","des3","idea"];var c=e.exports.ciphers;e.exports.createPasswordFile=function(e,r,t){if(!e||!Object.prototype.hasOwnProperty.call(e,"password")||!Object.prototype.hasOwnProperty.call(e,"passType")||!/^(word|in|out)$/.test(e.passType)){return false}var o=n.join(a,i.randomBytes(20).toString("hex"));t.push(o);e.password=e.password.trim();if(e.password===""){e.mustPass=true}if(e.cipher&&c.indexOf(e.cipher)!==-1){r.push("-"+e.cipher)}r.push("-pass"+e.passType);if(e.mustPass){r.push("pass:"+e.password)}else{s.writeFileSync(o,e.password);r.push("file:"+o)}return true};e.exports.deleteTempFiles=function(e,r){var t=[];if(typeof e==="string"){t.push(e)}else if(Array.isArray(e)){t=e}else{return r(new Error("Unexcepted files parameter type; only string or array supported"))}var deleteSeries=function(e,r){if(e.length){var t=e.shift();var myCallback=function(t){if(t&&t.code==="ENOENT"){return deleteSeries(e,r)}else if(t){return r(t)}else{return deleteSeries(e,r)}};if(t&&typeof t==="string"){s.unlink(t,myCallback)}else{return deleteSeries(e,r)}}else{return r(null)}};deleteSeries(t,r)}},702:(e,r,t)=>{var n=t(649);var{debug:s}=t(762);var i=t(81).spawn;var o=t(81).spawnSync;var a=t(17);var c=t(147);const{tmpdir:u}=t(37);var f=t(113);var p=t(143);var l={};var d=process.env.PEMJS_TMPDIR||u();const h=new RegExp("^(OpenSSL|LibreSSL) (((\\d+).(\\d+)).(\\d+))([a-z]+)?");if("DEBUG"in process.env&&process.env.DEBUG==="true"){if("LIBRARY"in process.env&&"VERSION"in process.env&&process.env.LIBRARY!=""&&process.env.VERSION!=""){const e=`./openssl/${process.env.LIBRARY}_v${process.env.VERSION}/bin/openssl`;if(c.existsSync(e)){process.env.OPENSSL_BIN=e}}}function set(e,r){l[e]=r}function get(e){return l[e]||null}function exec(e,r,t,n){if(!n&&typeof t==="function"){n=t;t=false}spawnWrapper(e,t,(function(e,t,s,i){var o,a;if(e){return n(e)}if(o=s.match(new RegExp("-+BEGIN "+r+"-+$","mu"))){o=o.index}else{o=-1}if(r==="EC PARAMETERS"){r="EC PRIVATE KEY"}if(a=s.match(new RegExp("^\\-+END "+r+"\\-+","m"))){a=a.index+a[0].length}else{a=-1}if(o>=0&&a>=0){return n(null,s.substring(o,a))}else{return n(new Error(r+" not found from openssl output:\n---stdout---\n"+s+"\n---stderr---\n"+i+"\ncode: "+t))}}))}function execBinary(e,r,t){if(!t&&typeof r==="function"){t=r;r=false}spawnWrapper(e,r,true,(function(e,r,n,i){s("execBinary",{err:e,code:r,stdout:n,stderr:i});if(e){return t(e)}return t(null,n)}))}function spawn(e,r,t){var n=get("pathOpenSSL")||process.env.OPENSSL_BIN||"openssl";testOpenSSLPath(n,(function(s){if(s){return t(s)}var o=i(n,e);var a="";var c=r?Buffer.alloc(0):"";o.stdout.on("data",(function(e){if(!r){c+=e.toString("binary")}else{c=Buffer.concat([c,e])}}));o.stderr.on("data",(function(e){a+=e.toString("binary")}));var u=2;var f=-1;var p=false;var done=function(r){if(p){return}if(r){p=true;return t(r)}if(--u<1){p=true;if(f!==0){if(f===2&&(a===""||/depth lookup: unable to/.test(a)||/depth lookup: self(-|\s)signed certificate/.test(a))){return t(null,f,c,a)}return t(new Error("Invalid openssl exit code: "+f+"\n% openssl "+e.join(" ")+"\n"+a),f)}else{return t(null,f,c,a)}}};o.on("error",done);o.on("exit",(function(e){f=e;done()}));o.on("close",(function(){c=r?c:Buffer.from(c,"binary").toString("utf-8");a=Buffer.from(a,"binary").toString("utf-8");done()}))}))}function spawnWrapper(e,r,t,i){if(!i&&typeof t==="function"){i=t;t=false}var o=[];var u=[];if(r){r=[].concat(r);var p,l;for(l=0;l<e.length;l++){if(e[l]==="--TMPFILE--"){p=a.join(d,f.randomBytes(20).toString("hex"));o.push({path:p,contents:r.shift()});e[l]=p;u.push(p)}}}var h;for(l=0;l<o.length;l++){h=o[l];c.writeFileSync(h.path,h.contents)}spawn(e,t,(function(r,t,o,a){n.deleteTempFiles(u,(function(n){s(e[0],{err:r,fsErr:n,code:t,stdout:o,stderr:a});i(r||n,t,o,a)}))}))}function testOpenSSLPath(e,r){const t=p.sync(e,{nothrow:true});if(!t){return r(new Error("Could not find openssl on your system on this path: "+e))}r()}function setVersion(){var e=get("pathOpenSSL")||process.env.OPENSSL_BIN||"openssl";var r=o(e,["version"]);var t=String(r.stdout)+"\n"+String(r.stderr)+"\n"+String(r.error);let n=h.exec(t);if(n===null||n.length<=7)return;set("openSslVersion",n[1].toUpperCase());set("Vendor",n[1].toUpperCase());set("VendorVersion",n[2]);set("VendorVersionMajorMinor",n[3]);set("VendorVersionMajor",n[4]);set("VendorVersionMinor",n[5]);set("VendorVersionPatch",n[6]);set("VendorVersionBuildChar",typeof n[7]==="undefined"?"":n[7])}setVersion();e.exports={exec:exec,execBinary:execBinary,spawn:spawn,spawnWrapper:spawnWrapper,settings:l,set:set,get:get}},214:(e,r,t)=>{"use strict";const{debug:n}=t(762);const{promisify:s}=t(261);const{createHash:i}=t(5);var o=t(808);var a=t(649);var c=t(702);const hash_md5=e=>{if(Buffer.isBuffer(e)){return i("md5").update(e).digest("hex")}return i("md5").update(String(e),"utf8").digest("hex")};e.exports.createPrivateKey=createPrivateKey;e.exports.createDhparam=createDhparam;e.exports.createEcparam=createEcparam;e.exports.createCSR=createCSR;e.exports.createCertificate=createCertificate;e.exports.readCertificateInfo=readCertificateInfo;e.exports.getPublicKey=getPublicKey;e.exports.getFingerprint=getFingerprint;e.exports.getModulus=getModulus;e.exports.getDhparamInfo=getDhparamInfo;e.exports.createPkcs12=createPkcs12;e.exports.readPkcs12=readPkcs12;e.exports.verifySigningChain=verifySigningChain;e.exports.checkCertificate=checkCertificate;e.exports.checkPkcs12=checkPkcs12;e.exports.config=config;e.exports.convert=t(254);var u="-----BEGIN PRIVATE KEY-----";var f="-----END PRIVATE KEY-----";var p="-----BEGIN RSA PRIVATE KEY-----";var l="-----END RSA PRIVATE KEY-----";var d="-----BEGIN ENCRYPTED PRIVATE KEY-----";var h="-----END ENCRYPTED PRIVATE KEY-----";var g="-----BEGIN CERTIFICATE-----";var m="-----END CERTIFICATE-----";function createPrivateKey(e,r,t){if(!t&&!r&&typeof e==="function"){t=e;e=undefined;r={}}else if(!t&&e&&typeof r==="function"){t=r;r={}}e=Number(e)||2048;var s=["genrsa"];if(c.get("Vendor")==="OPENSSL"&&c.get("VendorVersionMajor")>=3){s.push("-traditional")}var i=[];if(r&&r.cipher&&Number(a.ciphers.indexOf(r.cipher))!==-1&&r.password){n("helper.createPasswordFile",{cipher:r.cipher,password:r.password,passType:"out"});a.createPasswordFile({cipher:r.cipher,password:r.password,passType:"out"},s,i)}s.push(e);n("version",c.get("openSslVersion"));c.exec(s,"(RSA |ENCRYPTED |)PRIVATE KEY",(function(e,r){function done(e){if(e){return t(e)}return t(null,{key:r})}a.deleteTempFiles(i,(function(t){n("createPrivateKey",{sslErr:e,fsErr:t,key:r,keyLength:r&&r.length});done(e||t)}))}))}function createDhparam(e,r){if(!r&&typeof e==="function"){r=e;e=undefined}e=Number(e)||512;var t=["dhparam","-outform","PEM",e];c.exec(t,"DH PARAMETERS",(function(e,t){if(e){return r(e)}return r(null,{dhparam:t})}))}function createEcparam(e,r,t,n){if(!n&&typeof t==="undefined"&&!r&&typeof e==="function"){n=e;e=undefined}else if(!n&&typeof t==="undefined"&&e&&typeof r==="function"){n=r;r=undefined}else if(!n&&typeof t==="function"&&e&&r){n=t;t=undefined}e=e||"secp256k1";r=r||"explicit";t=t||false;var s=["ecparam","-name",e,"-genkey","-param_enc",r];var i="EC PARAMETERS";if(t){s.push("-noout");i="EC PRIVATE KEY"}c.exec(s,i,(function(e,r){if(e){return n(e)}return n(null,{ecparam:r})}))}function createCSR(e,r){if(!r&&typeof e==="function"){r=e;e=undefined}let t=[];e=e||{};if(e.commonName&&(o.isIPv4(e.commonName)||o.isIPv6(e.commonName))){if(!e.altNames){e.altNames=[e.commonName]}else if(e.altNames.indexOf(e.commonName)===-1){e.altNames=e.altNames.concat([e.commonName])}}if(!e.clientKey){if(e&&(e.password||e.clientKeyPassword)){e.password=e.password||e.clientKeyPassword||""}createPrivateKey(e.keyBitsize||2048,e,(function(t,n){if(t){return r(t)}e.clientKey=n.key;createCSR(e,r)}));return}var n=["req","-new","-"+(e.hash||"sha256")];if(e.csrConfigFile){n.push("-config");n.push(e.csrConfigFile)}else{n.push("-subj");n.push(generateCSRSubject(e))}n.push("-key");n.push("--TMPFILE--");var s=[e.clientKey];var i=null;if(e&&(e.password||e.clientKeyPassword)){a.createPasswordFile({cipher:"",password:e.password||e.clientKeyPassword,passType:"in"},n,t)}if(e.altNames&&Array.isArray(e.altNames)&&e.altNames.length){n.push("-extensions");n.push("v3_req");n.push("-config");n.push("--TMPFILE--");var u=[];for(var f=0;f<e.altNames.length;f++){u.push((o.isIP(e.altNames[f])?"IP":"DNS")+"."+(f+1)+" = "+e.altNames[f])}s.push(i=["[req]","req_extensions = v3_req","distinguished_name = req_distinguished_name","[v3_req]","subjectAltName = @alt_names","[alt_names]",u.join("\n"),"[req_distinguished_name]","commonName = Common Name","commonName_max = 64"].join("\n"))}else if(e.config){i=e.config}if(e.clientKeyPassword){a.createPasswordFile({cipher:"",password:e.clientKeyPassword,passType:"in"},n,t)}c.exec(n,"CERTIFICATE REQUEST",s,(function(n,s){function done(t){if(t){return r(t)}r(null,{csr:s,config:i,clientKey:e.clientKey})}a.deleteTempFiles(t,(function(e){done(n||e)}))}))}function createCertificate(e,r){if(!r&&typeof e==="function"){r=e;e=undefined}e=e||{};if(!e.csr){createCSR(e,(function(t,n){if(t){return r(t)}e.csr=n.csr;e.config=n.config;e.clientKey=n.clientKey;createCertificate(e,r)}));return}if(!e.clientKey){e.clientKey=""}if(!e.serviceKey){if(e.selfSigned){e.serviceKey=e.clientKey}else{createPrivateKey(e.keyBitsize||2048,{cipher:e.cipher,password:e.clientKeyPassword||""},(function(t,n){if(t){return r(t)}e.serviceKey=n.key;createCertificate(e,r)}));return}}readCertificateInfo(e.csr,(function(t,n){if(t){return r(t)}var s=["x509","-req","-"+(e.hash||"sha256"),"-days",Number(e.days)||"365","-in","--TMPFILE--"];var i=[e.csr];var o=[];if(e.serviceCertificate){s.push("-CA");s.push("--TMPFILE--");s.push("-CAkey");s.push("--TMPFILE--");if(e.serial){s.push("-set_serial");if(a.isNumber(e.serial)){s.push("0x"+("0000000000000000000000000000000000000000"+e.serial.toString(16)).slice(-40))}else{if(a.isHex(e.serial)){if(e.serial.startsWith("0x")){e.serial=e.serial.substring(2,e.serial.length)}s.push("0x"+("0000000000000000000000000000000000000000"+e.serial).slice(-40))}else{s.push("0x"+("0000000000000000000000000000000000000000"+a.toHex(e.serial)).slice(-40))}}}else{s.push("-CAcreateserial");if(e.serialFile){s.push("-CAserial");s.push(e.serialFile+".srl")}}if(e.serviceKeyPassword){a.createPasswordFile({cipher:"",password:e.serviceKeyPassword,passType:"in"},s,o)}i.push(e.serviceCertificate);i.push(e.serviceKey)}else{s.push("-signkey");s.push("--TMPFILE--");if(e.serviceKeyPassword){a.createPasswordFile({cipher:"",password:e.serviceKeyPassword,passType:"in"},s,o)}i.push(e.serviceKey)}if(e.config){s.push("-extensions");s.push("v3_req");s.push("-extfile");s.push("--TMPFILE--");i.push(e.config)}else if(e.extFile){s.push("-extfile");s.push(e.extFile)}else{var u=[];if(n&&n.san){for(var f=0;f<n.san.dns.length;f++){u.push("DNS"+"."+(f+1)+" = "+n.san.dns[f])}for(var p=0;p<n.san.ip.length;p++){u.push("IP"+"."+(p+1)+" = "+n.san.ip[p])}for(var l=0;l<n.san.email.length;l++){u.push("email"+"."+(l+1)+" = "+n.san.email[l])}s.push("-extensions");s.push("v3_req");s.push("-extfile");s.push("--TMPFILE--");i.push(["[v3_req]","subjectAltName = @alt_names","[alt_names]",u.join("\n")].join("\n"))}}if(e.clientKeyPassword){a.createPasswordFile({cipher:"",password:e.clientKeyPassword,passType:"in"},s,o)}c.exec(s,"CERTIFICATE",i,(function(t,n){function done(t){if(t){return r(t)}var s={csr:e.csr,clientKey:e.clientKey,certificate:n,serviceKey:e.serviceKey};return r(null,s)}a.deleteTempFiles(o,(function(e){done(t||e)}))}))}))}function getPublicKey(e,r){if(!r&&typeof e==="function"){r=e;e=undefined}e=(e||"").toString();var t;if(e.match(/BEGIN(\sNEW)? CERTIFICATE REQUEST/)){t=["req","-in","--TMPFILE--","-pubkey","-noout"]}else if(e.match(/BEGIN RSA PRIVATE KEY/)||e.match(/BEGIN PRIVATE KEY/)){t=["rsa","-in","--TMPFILE--","-pubout"]}else{t=["x509","-in","--TMPFILE--","-pubkey","-noout"]}c.exec(t,"PUBLIC KEY",e,(function(e,t){if(e){return r(e)}return r(null,{publicKey:t})}))}function readCertificateInfo(e,r){if(!r&&typeof e==="function"){r=e;e=undefined}e=(e||"").toString();var t=e.match(/BEGIN(\sNEW)? CERTIFICATE REQUEST/);var n=t?"req":"x509";var s=[n,"-noout","-nameopt","RFC2253,sep_multiline,space_eq,-esc_msb,utf8","-text","-in","--TMPFILE--"];c.spawnWrapper(s,e,(function(e,t,n,s){if(e){return r(e)}else if(s){return r(s)}return fetchCertificateData(n,r)}))}function getModulus(e,r,t,n){if(!n&&!t&&typeof r==="function"){n=r;r=undefined;t=false}else if(!n&&t&&typeof t==="function"){n=t;t=false}if(t&&t!=="md5"){t=false}e=Buffer.isBuffer(e)&&e.toString()||e;let s;if(e.match(/BEGIN(\sNEW)? CERTIFICATE REQUEST/)){s="req"}else if(e.match(/BEGIN RSA PRIVATE KEY/)||e.match(/BEGIN PRIVATE KEY/)){s="rsa"}else{s="x509"}let i=[s,"-noout","-modulus","-in","--TMPFILE--"];let o=[];if(r){a.createPasswordFile({cipher:"",password:r,passType:"in"},i,o)}c.spawnWrapper(i,e,(function(e,r,s,i){function done(e){if(e){return n(e)}var r=s.match(/Modulus=([0-9a-fA-F]+)$/m);if(r){if(t==="md5"){return n(null,{modulus:hash_md5(r[1])})}return n(null,{modulus:r[1]})}else{return n(new Error("No modulus"))}}a.deleteTempFiles(o,(function(r){done(e||r||i)}))}))}function getDhparamInfo(e,r){e=Buffer.isBuffer(e)&&e.toString()||e;var t=["dhparam","-text","-in","--TMPFILE--"];c.spawnWrapper(t,e,(function(e,t,n,s){if(e){return r(e)}else if(s){return r(s)}var i={};var o=n.match(/Parameters: \((\d+) bit\)/);if(o){i.size=Number(o[1])}var a="";n.split("\n").forEach((function(e){if(/\s+([0-9a-f][0-9a-f]:)+[0-9a-f]?[0-9a-f]?/g.test(e)){a+=e.trim()}}));if(a){i.prime=a}if(!o&&!a){return r(new Error("No DH info found"))}return r(null,i)}))}function config(e){Object.keys(e).forEach((function(r){c.set(r,e[r])}))}function getFingerprint(e,r,t){if(!t&&typeof r==="function"){t=r;r=undefined}r=r||"sha1";var n=["x509","-in","--TMPFILE--","-fingerprint","-noout","-"+r];c.spawnWrapper(n,e,(function(e,r,n,s){if(e){return t(e)}else if(s){return t(s)}var i=n.match(/Fingerprint=([0-9a-fA-F:]+)$/m);if(i){return t(null,{fingerprint:i[1]})}else{return t(new Error("No fingerprint"))}}))}function createPkcs12(e,r,t,n,s){if(!s&&typeof n==="function"){s=n;n={}}var i=["pkcs12","-export"];var o=[];if(n.cipher&&n.clientKeyPassword){a.createPasswordFile({cipher:n.cipher,password:n.clientKeyPassword,passType:"in"},i,o)}a.createPasswordFile({cipher:"",password:t,passType:"word"},i,o);i.push("-in");i.push("--TMPFILE--");i.push("-inkey");i.push("--TMPFILE--");var u=[r,e];if(n.certFiles){u.push(n.certFiles.join(""));i.push("-certfile");i.push("--TMPFILE--")}c.execBinary(i,u,(function(e,r){function done(e){if(e){return s(e)}return s(null,{pkcs12:r})}a.deleteTempFiles(o,(function(r){done(e||r)}))}))}function readPkcs12(e,r,t){if(!t&&typeof r==="function"){t=r;r={}}r.p12Password=r.p12Password||"";var s=[];var i=[];var o=["pkcs12","-in",e];a.createPasswordFile({cipher:"",password:r.p12Password,passType:"in"},o,i);if(Buffer.isBuffer(e)){s=[e];o[2]="--TMPFILE--"}if(c.get("Vendor")==="OPENSSL"&&c.get("VendorVersionMajor")>=3){o.push("-legacy");o.push("-traditional")}if(r.clientKeyPassword){a.createPasswordFile({cipher:"",password:r.clientKeyPassword,passType:"out"},o,i)}else{o.push("-nodes")}c.execBinary(o,s,(function(e,s){function done(e){var i={};if(e&&e.message.indexOf("No such file or directory")!==-1){e.code="ENOENT"}if(!e){var o=readFromString(s,g,m);i.cert=o.shift();i.ca=o;i.key=readFromString(s,u,f).pop();n("readPkcs12.execBinary - PRIVATE KEY - ?: ",i.key);if(i.key){var a=["rsa"];if(c.get("Vendor")==="OPENSSL"&&c.get("VendorVersionMajor")>=3){a.push("-traditional")}a.push("-in");a.push("--TMPFILE--");return c.exec(a,"(RSA |)PRIVATE KEY",[i.key],(function(e,r){if(e){n("readPkcs12.execBinary - PRIVATE KEY convert - error: ",e)}i.key=r;return t(e,i)}))}if(r.clientKeyPassword){i.key=readFromString(s,d,h).pop();n("readPkcs12.execBinary - ENCRYPTED PRIVATE KEY - ?: ",i.key)}else{i.key=readFromString(s,p,l).pop();n("readPkcs12.execBinary - RSA PRIVATE KEY - ?: ",i.key)}}return t(e,i)}a.deleteTempFiles(i,(function(r){done(e||r)}))}))}function checkCertificate(e,r,t){var n;var s=[];if(!t&&typeof r==="function"){t=r;r=undefined}e=(e||"").toString();if(e.match(/BEGIN(\sNEW)? CERTIFICATE REQUEST/)){n=["req","-text","-noout","-verify","-in","--TMPFILE--"]}else if(e.match(/BEGIN RSA PRIVATE KEY/)||e.match(/BEGIN PRIVATE KEY/)){n=["rsa","-noout","-check","-in","--TMPFILE--"]}else{n=["x509","-text","-noout","-in","--TMPFILE--"]}if(r){a.createPasswordFile({cipher:"",password:r,passType:"in"},n,s)}c.spawnWrapper(n,e,(function(e,r,i,o){function done(e){i=i&&i.trim();var r;switch(n[0]){case"rsa":r=/^Rsa key ok$/i.test(i);break;default:r=/Signature Algorithm/im.test(i);break}if(!r){if(c.get("Vendor")==="OPENSSL"&&c.get("VendorVersionMajor")>=3){if(!(o&&o.toString().trim().endsWith("verify OK"))){return t(new Error(o.toString()))}}if(e&&e.toString().trim()!=="verify OK"){return t(e)}}t(null,r)}a.deleteTempFiles(s,(function(r){done(e||r||o)}))}))}function checkPkcs12(e,r,t){if(!t&&typeof r==="function"){t=r;r=""}var s=[];var i=[];var o=["pkcs12","-info","-in",e,"-noout","-maciter","-nodes"];a.createPasswordFile({cipher:"",password:r,passType:"in"},o,i);if(Buffer.isBuffer(e)){s=[e];o[3]="--TMPFILE--"}if(c.get("Vendor")==="OPENSSL"&&c.get("VendorVersionMajor")>=3){o.splice(2,0,"-legacy")}c.spawnWrapper(o,s,(function(e,r,s,o){n("checkPkcs12 error",{err:e,code:r,stdout:s,stdoutResult:/MAC verified OK/im.test(o)||!/MAC verified OK/im.test(o)&&!/Mac verify error/im.test(o),stderr:o});function done(e){if(e){return t(e)}t(null,/MAC verified OK/im.test(o)||!/MAC verified OK/im.test(o)&&!/Mac verify error/im.test(o))}a.deleteTempFiles(i,(function(t){n("checkPkcs12 clean-up error",{sslErr:e,fsErr:t,code:r,stdout:s,stdoutResult:/MAC verified OK/im.test(o)||!/MAC verified OK/im.test(o)&&!/Mac verify error/im.test(o),stderr:o});done(e||t)}))}))}function verifySigningChain(e,r,t){if(!t&&typeof r==="function"){t=r;r=undefined}if(!Array.isArray(e)){e=readFromString(e,g,m)}if(!Array.isArray(r)&&r!==undefined){if(r!==""){r=[r]}}var s=["verify"];var i=[];if(r!==undefined){s.push("-CAfile");s.push("--TMPFILE--");i.push(r.join("\n"))}var o=e.shift();if(e.length>0){s.push("-untrusted");s.push("--TMPFILE--");i.push(e.join("\n"))}s.push("--TMPFILE--");i.push(o);c.spawnWrapper(s,i,(function(e,r,s,i){n("Vendor",c.get("Vendor"));n("VendorVersionMajor",c.get("VendorVersionMajor"));n("openssl.get('VendorVersionMajor') >= 3",c.get("VendorVersionMajor")>=3);if(c.get("Vendor")==="OPENSSL"&&c.get("VendorVersionMajor")>=3){let o=!!(s&&s.trim().includes(": OK"));if(e){n("verifySigningChain error",{err:e,code:r,stdout:s,stdoutResult:o,stderr:i});return t(e)}n("verifySigningChain error - use stderr",{err:e,code:r,stdout:s.trim(),stdoutResult:o,stderr:i.trim()});return t(null,o)}if(e){n("verifySigningChain error",{err:e,code:r,stdout:s,stdoutResult:s&&s.trim().slice(-4)===": OK",stderr:i});return t(e)}n("verifySigningChain",{err:e,code:r,stdout:s,stdoutResult:s&&s.trim().slice(-4)===": OK",stderr:i});t(null,s&&s.trim().slice(-4)===": OK")}))}function fetchCertificateData(e,r){try{e=(e||"").toString();var t,n,s,i;var o={issuer:{}};var a={};var c;var u,f;if((t=e.match(/\s*Serial Number:\r?\n?\s*([^\r\n]*)\r?\n\s*\b/))&&t.length>1){o.serial=t[1]}if((n=e.match(/\s*Subject:\r?\n(\s*(([a-zA-Z0-9.]+)\s=\s[^\r\n]+\r?\n))*\s*\b/))&&n.length>1){n=n[0];s=matchAll(n,/\s([a-zA-Z0-9.]+)\s=\s([^\r\n].*)/g);if(s){for(f=0;f<s.length;f++){u=s[f][1].trim();if(u.match("(C|ST|L|O|OU|CN|emailAddress|DC)")||u===""){continue}o[u]=s[f][2].trim()}}s=n.match(/\sC\s=\s([^\r\n].*?)[\r\n]/);o.country=s&&s[1]||"";s=n.match(/\sST\s=\s([^\r\n].*?)[\r\n]/);o.state=s&&s[1]||"";s=n.match(/\sL\s=\s([^\r\n].*?)[\r\n]/);o.locality=s&&s[1]||"";s=matchAll(n,/\sO\s=\s([^\r\n].*)/g);o.organization=s?s.length>1?s.sort((function(e,r){var t=e[1].toUpperCase();var n=r[1].toUpperCase();return n>t?-1:t>n?1:0})).sort((function(e,r){return e[1].length-r[1].length})).map((function(e){return e[1]})):s[0][1]:"";s=matchAll(n,/\sOU\s=\s([^\r\n].*)/g);o.organizationUnit=s?s.length>1?s.sort((function(e,r){var t=e[1].toUpperCase();var n=r[1].toUpperCase();return n>t?-1:t>n?1:0})).sort((function(e,r){return e[1].length-r[1].length})).map((function(e){return e[1]})):s[0][1]:"";s=matchAll(n,/\sCN\s=\s([^\r\n].*)/g);o.commonName=s?s.length>1?s.sort((function(e,r){var t=e[1].toUpperCase();var n=r[1].toUpperCase();return n>t?-1:t>n?1:0})).sort((function(e,r){return e[1].length-r[1].length})).map((function(e){return e[1]})):s[0][1]:"";s=matchAll(n,/emailAddress\s=\s([^\r\n].*)/g);o.emailAddress=s?s.length>1?s.sort((function(e,r){var t=e[1].toUpperCase();var n=r[1].toUpperCase();return n>t?-1:t>n?1:0})).sort((function(e,r){return e[1].length-r[1].length})).map((function(e){return e[1]})):s[0][1]:"";s=matchAll(n,/\sDC\s=\s([^\r\n].*)/g);o.dc=s?s.length>1?s.sort((function(e,r){var t=e[1].toUpperCase();var n=r[1].toUpperCase();return n>t?-1:t>n?1:0})).sort((function(e,r){return e[1].length-r[1].length})).map((function(e){return e[1]})):s[0][1]:""}if((i=e.match(/\s*Issuer:\r?\n(\s*([a-zA-Z0-9.]+)\s=\s[^\r\n].*\r?\n)*\s*\b/))&&i.length>1){i=i[0];s=matchAll(i,/\s([a-zA-Z0-9.]+)\s=\s([^\r\n].*)/g);for(f=0;f<s.length;f++){u=s[f][1].toString();if(u.match("(C|ST|L|O|OU|CN|emailAddress|DC)")){continue}o.issuer[u]=s[f][2].toString()}s=i.match(/\sC\s=\s([^\r\n].*?)[\r\n]/);o.issuer.country=s&&s[1]||"";s=i.match(/\sST\s=\s([^\r\n].*?)[\r\n]/);o.issuer.state=s&&s[1]||"";s=i.match(/\sL\s=\s([^\r\n].*?)[\r\n]/);o.issuer.locality=s&&s[1]||"";s=matchAll(i,/\sO\s=\s([^\r\n].*)/g);o.issuer.organization=s?s.length>1?s.sort((function(e,r){var t=e[1].toUpperCase();var n=r[1].toUpperCase();return n>t?-1:t>n?1:0})).sort((function(e,r){return e[1].length-r[1].length})).map((function(e){return e[1]})):s[0][1]:"";s=matchAll(i,/\sOU\s=\s([^\r\n].*)/g);o.issuer.organizationUnit=s?s.length>1?s.sort((function(e,r){var t=e[1].toUpperCase();var n=r[1].toUpperCase();return n>t?-1:t>n?1:0})).sort((function(e,r){return e[1].length-r[1].length})).map((function(e){return e[1]})):s[0][1]:"";s=matchAll(i,/\sCN\s=\s([^\r\n].*)/g);o.issuer.commonName=s?s.length>1?s.sort((function(e,r){var t=e[1].toUpperCase();var n=r[1].toUpperCase();return n>t?-1:t>n?1:0})).sort((function(e,r){return e[1].length-r[1].length})).map((function(e){return e[1]})):s[0][1]:"";s=matchAll(i,/\sDC\s=\s([^\r\n].*)/g);o.issuer.dc=s?s.length>1?s.sort((function(e,r){var t=e[1].toUpperCase();var n=r[1].toUpperCase();return n>t?-1:t>n?1:0})).sort((function(e,r){return e[1].length-r[1].length})).map((function(e){return e[1]})):s[0][1]:""}if((c=e.match(/X509v3 Subject Alternative Name: \r?\n([^\r\n]*)\r?\n/))&&c.length>1){c=c[1].trim()+"\n";o.san={};s=pregMatchAll("DNS:([^,\\r\\n].*?)[,\\r\\n\\s]",c);o.san.dns=s||"";s=pregMatchAll("IP Address:([^,\\r\\n].*?)[,\\r\\n\\s]",c);o.san.ip=s||"";s=pregMatchAll("email:([^,\\r\\n].*?)[,\\r\\n\\s]",c);o.san.email=s||""}if((s=e.match(/Not Before\s?:\s?([^\r\n]*)\r?\n/))&&s.length>1){a.start=Date.parse(s&&s[1]||"")}if((s=e.match(/Not After\s?:\s?([^\r\n]*)\r?\n/))&&s.length>1){a.end=Date.parse(s&&s[1]||"")}if(a.start&&a.end){o.validity=a}if((s=e.match(/Signature Algorithm: ([^\r\n]*)\r?\n/))&&s.length>1){o.signatureAlgorithm=s&&s[1]||""}if((s=e.match(/Public[ -]Key: ([^\r\n]*)\r?\n/))&&s.length>1){o.publicKeySize=(s&&s[1]||"").replace(/[()]/g,"")}if((s=e.match(/Public Key Algorithm: ([^\r\n]*)\r?\n/))&&s.length>1){o.publicKeyAlgorithm=s&&s[1]||""}r(null,o)}catch(e){r(e)}}function matchAll(e,r){var t=[];e.replace(r,(function(){var e=[].slice.call(arguments,0);var r=e.splice(-2);e.index=r[0];e.input=r[1];t.push(e)}));return t.length?t:null}function pregMatchAll(e,r){var t=new RegExp(e,"g");var n=r.match(t)||[];var s=[];var i,o;for(var a=0;a<n.length;a++){i=new RegExp(e);o=n[a].match(i);s.push(o[1])}return s}function generateCSRSubject(e){e=e||{};var r={C:e.country||e.C,ST:e.state||e.ST,L:e.locality||e.L,O:e.organization||e.O,OU:e.organizationUnit||e.OU,CN:e.commonName||e.CN||"localhost",DC:e.dc||e.DC||"",emailAddress:e.emailAddress};var t=Object.keys(r).map((function(e){if(r[e]){if(typeof r[e]==="object"&&r[e].length>=1){var t="";r[e].map((function(r){t+="/"+e+"="+r.replace(/[^\w\s-!$%^&*()_+|~=`{}[\]:/;<>?,.@#]+/g," ").replace("/","\\/").replace("+","\\+").trim()}));return t}else{return"/"+e+"="+r[e].replace(/[^\w\s-!$%^&*()_+|~=`{}[\]:/;<>?,.@#]+/g," ").replace("/","\\/").replace("+","\\+").trim()}}}));return t.join("")}function readFromString(e,r,t){if(Buffer.isBuffer(e)){e=e.toString("utf8")}var n=[];if(!e){return n}var s=e.indexOf(r);while(s!==-1){e=e.substring(s);var i=e.indexOf(t);if(i===-1){break}i+=t.length;n.push(e.substring(0,i));s=e.indexOf(r,i)}return n}e.exports.promisified={createPrivateKey:s(createPrivateKey),createDhparam:s(createDhparam),createEcparam:s(createEcparam),createCSR:s(createCSR),createCertificate:s(createCertificate),readCertificateInfo:s(readCertificateInfo),getPublicKey:s(getPublicKey),getFingerprint:s(getFingerprint),getModulus:s(getModulus),getDhparamInfo:s(getDhparamInfo),createPkcs12:s(createPkcs12),readPkcs12:s(readPkcs12),verifySigningChain:s(verifySigningChain),checkCertificate:s(checkCertificate),checkPkcs12:s(checkPkcs12)}},200:function(e,r,t){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,r,t,n){if(n===undefined)n=t;var s=Object.getOwnPropertyDescriptor(r,t);if(!s||("get"in s?!r.__esModule:s.writable||s.configurable)){s={enumerable:true,get:function(){return r[t]}}}Object.defineProperty(e,n,s)}:function(e,r,t,n){if(n===undefined)n=t;e[n]=r[t]});var s=this&&this.__setModuleDefault||(Object.create?function(e,r){Object.defineProperty(e,"default",{enumerable:true,value:r})}:function(e,r){e["default"]=r});var i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var r={};if(e!=null)for(var t in e)if(t!=="default"&&Object.prototype.hasOwnProperty.call(e,t))n(r,e,t);s(r,e);return r};var o=this&&this.__exportStar||function(e,r){for(var t in e)if(t!=="default"&&!Object.prototype.hasOwnProperty.call(r,t))n(r,e,t)};Object.defineProperty(r,"__esModule",{value:true});r.sync=r.isexe=r.posix=r.win32=void 0;const a=i(t(523));r.posix=a;const c=i(t(323));r.win32=c;o(t(252),r);const u=process.env._ISEXE_TEST_PLATFORM_||process.platform;const f=u==="win32"?c:a;r.isexe=f.isexe;r.sync=f.sync},252:(e,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:true})},523:(e,r,t)=>{"use strict";Object.defineProperty(r,"__esModule",{value:true});r.sync=r.isexe=void 0;const n=t(147);const s=t(292);const isexe=async(e,r={})=>{const{ignoreErrors:t=false}=r;try{return checkStat(await(0,s.stat)(e),r)}catch(e){const r=e;if(t||r.code==="EACCES")return false;throw r}};r.isexe=isexe;const sync=(e,r={})=>{const{ignoreErrors:t=false}=r;try{return checkStat((0,n.statSync)(e),r)}catch(e){const r=e;if(t||r.code==="EACCES")return false;throw r}};r.sync=sync;const checkStat=(e,r)=>e.isFile()&&checkMode(e,r);const checkMode=(e,r)=>{const t=r.uid??process.getuid?.();const n=r.groups??process.getgroups?.()??[];const s=r.gid??process.getgid?.()??n[0];if(t===undefined||s===undefined){throw new Error("cannot get uid or gid")}const i=new Set([s,...n]);const o=e.mode;const a=e.uid;const c=e.gid;const u=parseInt("100",8);const f=parseInt("010",8);const p=parseInt("001",8);const l=u|f;return!!(o&p||o&f&&i.has(c)||o&u&&a===t||o&l&&t===0)}},323:(e,r,t)=>{"use strict";Object.defineProperty(r,"__esModule",{value:true});r.sync=r.isexe=void 0;const n=t(147);const s=t(292);const isexe=async(e,r={})=>{const{ignoreErrors:t=false}=r;try{return checkStat(await(0,s.stat)(e),e,r)}catch(e){const r=e;if(t||r.code==="EACCES")return false;throw r}};r.isexe=isexe;const sync=(e,r={})=>{const{ignoreErrors:t=false}=r;try{return checkStat((0,n.statSync)(e),e,r)}catch(e){const r=e;if(t||r.code==="EACCES")return false;throw r}};r.sync=sync;const checkPathExt=(e,r)=>{const{pathExt:t=process.env.PATHEXT||""}=r;const n=t.split(";");if(n.indexOf("")!==-1){return true}for(let r=0;r<n.length;r++){const t=n[r].toLowerCase();const s=e.substring(e.length-t.length).toLowerCase();if(t&&s===t){return true}}return false};const checkStat=(e,r,t)=>e.isFile()&&checkPathExt(r,t)}};var r={};function __nccwpck_require__(t){var n=r[t];if(n!==undefined){return n.exports}var s=r[t]={exports:{}};var i=true;try{e[t].call(s.exports,s,s.exports,__nccwpck_require__);i=false}finally{if(i)delete r[t]}return s.exports}if(typeof __nccwpck_require__!=="undefined")__nccwpck_require__.ab=__dirname+"/";var t=__nccwpck_require__(214);module.exports=t})();
//# sourceMappingURL=index.js.map